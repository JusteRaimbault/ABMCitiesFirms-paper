\documentclass[10pt,letterpaper]{article}
\input{header.tex}

\usepackage{ragged2e}
\begin{document}
\justify
\vspace*{0.2in}

\begin{flushleft}
{\Large
\textbf\newline{Modelling growth of urban firm networks}
}
\newline

\\
Juste Raimbault\textsuperscript{1,2,3 *},
Natalia Zdanowska\textsuperscript{3,4,5},
Elsa Arcaute\textsuperscript{4}
\\
\bigskip
\textbf{1} LASTIG, Univ Gustave Eiffel, IGN-ENSG, Saint-Mand{\'e}, France
\\
\textbf{2} UPS CNRS 3611 ISC-PIF, Paris, France
\\
\textbf{3} UMR CNRS 8504 G{\'e}ographie-cit{\'e}s, Paris, France
\\
\textbf{4} Centre for Advanced Spatial Analysis, UCL, London, United Kingdom
\\
\textbf{5} Luxembourg Institute of Socio-Economic Research, Esch-sur-Alzette, Luxembourg

\bigskip

% Use the asterisk to denote corresponding authorship and provide email address in note below.
* juste.raimbault@polytechnique.edu

\end{flushleft}


\section*{Abstract}
The emergence of interconnected urban networks is a crucial feature of globalisation processes. Understanding the drivers behind the growth of such networks -- in particular urban firm networks --, is essential for the economic resilience of urban systems. We introduce in this paper a generative model for firm networks at the urban area level, which considers the following features: the economic size of the areas representing the source and target nodes, the industrial sector proximity between firms, the strength of links from the past, as well as the geographical and socio-cultural distances between urban areas. An empirical network analysis on European urban firm ownership data confirms the relevance of each of these factors on new link creation. We then simulate network growth on synthetic systems of cities, unveiling stylized facts such as a transition from a local to a global regime or a maximal integration achieved at an intermediate interaction range. We calibrate the model on the European network, outperforming statistical models, and showing a strong role of path-dependency. The model is applied to stylised scenarios, opening up to the formulation of public policies recommendations to deal with exogenous shocks such as economic crises or potential lock-downs of countries.

\linenumbers

% Keywords
% Urban firm networks; Simulation model; Model calibration


\section*{Introduction}

Networks constitute the new social morphology of our societies, since the intensification of globalisation of the economy in the late 20th century \cite{castells2000networksociety}. A world-city system has since then emerged \cite{taylor2001specification}, characterized by highly interconnected urban centres at the global level \cite{sassen1991}. These interactions can be of different nature and determined by economic, socio-cultural, or geopolitical proximity inducing spatial and non-spatial patterns \cite{martinus2018global}. Interactions of economic nature between transnational firms \cite{derudder2018central}, are together with international trade patterns among the most representative of the current economic trends \cite{taylor2001specification}. Understanding the drivers of growth and geographical properties of such an urban network, can be used to foster innovation in specific cities and to shape public policies for local industrial clusters \cite{turkina2016structure}. In addition, strengthening city-interactions can be crucial for revitalising certain geographical areas \cite{Clarke2018}. This can be achieved through strategic development of certain industrial sectors for global integration of regions \cite{dawley2019creating}, cities \cite{gluckler2016relational} and countries \cite{martinus2019brokerage}. Exploring city/firm interactions \cite{storme2019introducing} and the position of cities within these networks \cite{gluckler2016relational} can also allow us to infer the consequences of unforeseen exogenous shocks such as an economic crisis, a post-Brexit scenario for the European Union or a single market collapse in the post-COVID19 future.

Network models to understand processes underlying the emergence and dynamics of such networks have been proposed in the literature, nevertheless, these are not extensive and do not explicitly model the city level \cite{taylor2001specification}. At regional scale, generative urban network models combining geographical factors with network topological properties have been proposed \cite{dai2016simulating}. At country level, trade networks have been extensively studied from the complex networks perspective \cite{garlaschelli2005structure}, but these are generally not explored at a more granular level due to the lack of city-level data. 
Within this work, we contribute to the research at an interurban level, exploring the position and dynamics of cities in the socio-economic world-wide space \cite{pumain2018evolutionary} \cite{berry1964cities}, by considering the interactions between the firms in the cities. 
An extensive literature exists exploring firm-to-firm level networks in economic geography. For example, within the input-output models framework, these are used to study inter-sectors and inter-region transactions \cite{Rodriguesetal2016}, or firm level productivity, to understand macroeconomic level outcomes \cite{Grassi2016} and economic resilience \cite{Ialongo2021}.
At a more granular level, urban firm networks have been investigated in complexity science \cite{RozenblatNeal2021} to unveil agglomeration economies and competitiveness of cities \cite{Rozenblat2010}, regionalisation patterns \cite{Rozenblatetal2017} or to model hierarchy and specialisation \cite{BidaRozenblat2020}. Moreover economic complexity indicators have been developed in this sense to characterise the production structure and specialisation of different countries due to economic activity, including those of trade firms \cite{HaussmanHidalgo2009,OCleary2016}. This work complements this effort by proposing a generative mechanism of such networks. 

Another contribution of the present study is the derivation of geographical and economic processes such as internationalisation and metropolisation of cities, through the proposed generative model of firm networks, where weights of cities are given by shares of turnovers generated by ownership links between firms. Previous literature considers mostly weights as GDP of countries, for example in gravity models of export-import firms networks \cite{Kepaptsogloual2010} \cite{MinondoRequena2013}. Input-output models, mostly used in regional science to represent flows between geographical areas, are considered in some cases as a type of urban generative model \cite{jin1993generation}. In this stream of research, spatial interaction models \cite{dennett2013multilevel} can form the basis of urban network models for different types of flows \cite{dai2016generative} or for the physical infrastructure \cite{raimbault2018indirect} at different geographical scales. 

%The first main contribution of this paper is to focus on interurban interactions between firms. Firm networks remains a central aspect of network and system of cities theory \cite{RozenblatNeal2021} from the economic perspective. In this approach the position and dynamics of cities in the socio-economic world-wide space can be considered by their interactions with other cities \cite{pumain2018evolutionary} \cite{berry1964cities}. An extensive literature exists to explore firm-to-firm level networks in economic geography withing the input-output models framework in order to study inter-sectors and inter-region transactions \cite{Rodriguesetal2016} or firm level productivity to understand macroeconomic level outcomes \cite{Grassi2016} and economic resilience \cite{Ialongo2021}. Studies of these firm networks at city level remain still scarce. Urban firm networks have been investigated in complexity science to unveil agglomeration economies and competitiveness of cities \cite{Rozenblat2010}, regionalisation patterns \cite{Rozenblatetal2017} or to model hierarchy and specialisation \cite{BidaRozenblat2020}. Moreover economic complexity indicators have been developed in this sense to characterise the production structure and specialisation of different countries due to economic activity, including those of trade firms \cite{HaussmanHidalgo2009,OCleary2016}. 

%The second contribution of the present study is to question and capture geographical and economic processes as internationalisation and metropolisation of cities in terms of firm networks within a generative model, where weights of cities are given by shares of turnovers generated by ownership links between firms. Previous literature considers mostly weights as GDP of countries for example in gravity models of export-import firms networks \cite{Kepaptsogloual2010} \cite{MinondoRequena2013}. The use of network models to understand processes underlying the emergence and dynamics of such networks has already been tackled in the literature, but still not extensively and never explicitly at city level \cite{taylor2001specification}. In fact generative urban network models combining geographical factors with network topological properties exist at the regional scale {\cite{dai2016simulating}}. Trade networks have been extensively studied from the complex networks perspective, but these are generally driven at the country-level \cite{garlaschelli2005structure} because of a lack of city-level data. Input-output models, mostly used in regional science to represent flows between geographical areas, are considered in some cases as a type of urban generative model \cite{jin1993generation}. In this stream of research, spatial interaction models \cite{dennett2013multilevel} can form the basis of urban network models for different types of flows \cite{dai2016generative} or physical infrastructure \cite{raimbault2018indirect}. 

The specific question we tackle is the complementarity of the different processes to generate urban firm networks. We examine the interactions of European cities within firm linkages defined by corporate ownership links. Since transnational firms structure is one of the determinants of the global economic space, it provides one accurate proxy to unveil geo-economic structures \cite{2020Zdanowska}. More precisely: (i) we firstly introduce a generative network model to simulate the growth of such linkages at urban areas scale, combining multiple factors influencing link formation, such as the economic intensity of the urban areas corresponding to the source and target nodes, the industrial sector proximity, the strength of previous links, and the geographical and socio-cultural distances; (ii) the model allows us to then compare the effect of the different factors on the final network structure, which is extensively studied through model sensitivity analysis and exploration; (iii) we develop an empirical analysis of the firm ownership urban network in the European Union, based on the Bureau Van Dijk's \emph {AMADEUS} database \cite{AMADEUS2018};  (iv) we use this data to calibrate the model on the empirical network; and (v) we explore an application of the model to an economic shock scenario, with pandemic-like stylised facts. 


%The rest of this paper is organized as follows: we firstly describe the generative model for urban networks and then present an empirical analysis of the network used as a case study. We then perform a sensitivity analysis and exploration of the model parameters using synthetic data. The model is then calibrated on empirical European firm ownership data. We finally discuss implications of our results and possible extensions.

\section*{Materials and Methods}

\subsection*{Generative urban network model}

\subsubsection*{Rationale}

The model is expected to capture a single macroscopic urban scale, which corresponds to the level at which nodes are cities. These are characterised by their economic size and their industrial sector profile. Links are then created considering these features and different distance, or proximity measures \cite{martinus2018global}. Note that, geographical distance, industrial proximity and complementarity will typically be equally significant \cite{cottineau2020nested}. We therefore combine several features driving network growth: (i) geographical proximity (in our case the crow-fly distance between cities, but it can be generalised to any type of accessibility); (ii) geopolitical proximity, which captures the higher propensity to establish links within existing submarkets within the European common market (this is confirmed to be  relevant by the fixed effect regression described below); (iii) city economic size, which is known to give rise to agglomeration effects; (iv) industrial proximity in terms of firm sector composition; and (v) previous linkages, which capture the influence of existing linkages created in the past. This last point is crucial to capture accumulated effects and include path-dependencies, justifying further the use of a simulation model instead of a more simple statistical model.

It is worth mentioning that our model is not aimed to be predictive, but rather designed as an explanatory model in order to disentangle the influence of diverse processes and drivers in the growth of the urban network, and to test different hypotheses \cite{conte2012manifesto,varenne2018models}. The model can also be used as a decision-making model, where different scenarios for potential policy applications can be explored. 

In this work, we do not consider the relationship between countries given their economic complexity, such as the framework developed by  \cite{hidalgo2007product}, where the diversity of products produced plays an essential role in determining co-dependencies and resilience.
What we investigate instead, is the role of linkages given by geography and history, and hence, the sector structure of cities does not evolve within the model.


\subsubsection*{Model description}

Let $1 \leq i \leq N$ cities be defined at time $t$ by their economic structure such that $E_i(t)$ is the total economic volume (GDP) for city $i$ and $\mathbf{S_i} = S_{ik}(t)$ is a matrix giving economic volume proportions within each economic sector $k$, assuming that there are $K$ economic sectors. Given these characteristics, the model evolves firm links between cities. Starting with an existing initial network, the model iteratively adds links or updates their weights to generate a final directed weighted network.

At each time step, one directed link is randomly drawn. We define a generalized Cobb-Douglas utility function \cite{vilcu2011geometric} as 

\begin{equation}
u_{ij} = \left(\frac{E_{i}}{E}\right)^{\gamma_O} \cdot \left(\frac{E_{j}}{E}\right)^{\gamma_D} \cdot \left(\frac{w_{ij}}{W}\right)^{\gamma_W} \cdot s\left(\mathbf{S_{i}},\mathbf{S_{j}}\right)^{\gamma_S} \cdot \exp \left(- d_{ij} / d_0\right) \cdot \exp \left(- c_{ij} / c_0\right)
\end{equation}
where $E  =  \sum_k E_k$; $w_{ij}$ are the weights of previous links, and $W  = \sum_{i,j} w_{ij}$; $s(\mathbf{S_{i}},\mathbf{S_{j}})$ is a similarity function between the distributions of activity sectors, taken to be the cosine similarity; $d_{ij}$ is the Euclidian distance; and $c_{ij}$ is a socio-cultural distance.

This allows us to define the probability to select one link as $p_{ij} = u_{ij} / \sum_{k,l} u_{kl}$. The weight of this link is incremented by a unit volume $w_0$.

The simulation is stopped either when a final time $t_f$ is reached or when the cumulative volume of links reaches a target quantity. Therefore, the duration of the time period simulated can be adjusted by changing either $t_f$ or the $w_0$ parameter, given a total volume. 



This model formulation can be considered both as an economic utility model and as a generalisation of a spatial interaction model. We must furthermore precise that: (i) we consider an asymmetric influence of sizes, assuming that link directions are important (equivalently the similarity function $s$ may be taken as asymmetric); (ii) the influence of previous links is similar to a preferential attachment process; (iii) we do not renormalise the exponents to 1 to ensure the inclusion of convex functions. The ``geopolitical/sociocultural'' distance remains abstract and should be parametrised (see setup below) and estimated in the data-driven setting. In this simple version of the model, we do not consider the evolution of either the economic size nor of the sectorial proximity, which means that the adjusted parameters are valid on a limited time period.


\subsubsection*{Model setup}

When setting the model, it is important to consider that different initial conditions (or parametrisation on real data), given by the spatial distribution, the sizes and industrial sector compositions, are going to affect the behaviour of the model. One of the authors \cite{raimbault2019space} has already shown that the initial spatial configuration can have significant impacts on model outcomes. We therefore consider two versions: one with a synthetic system of cities which can be stochastically repeated, and one other based on real data.


\paragraph{Synthetic setup}

The synthetic system of cities is generated to be at the scale of a continent with properties similar to Europe: (i) $N=700$ cities with an empirical power-law from the Global Human Settlements database for economic sizes ($\alpha = 1.1$), distributed randomly into a uniform and isotropic square space of width $d_{max}=3000$km;
(ii) cities are clustered into $C = 20$ countries using a k-means algorithm (this remains consistent with non-correlated city sizes at the scale of the countries as our cities are randomly distributed in space \cite{simini2019testing});
(iii) their synthetic distribution of sectors follows a log-normal distribution adjusted in a way that large cities have more high-value activities and are more diverse.

More precisely, assuming that sectors are distributed continuously along a one-dimensional axis, cities are assumed to have a sector distribution with a log-normal density function. The largest city is constrained to have a standard deviation and a mode of $1/2$ while for the smallest city it will be $1/K$, with a linear interpolation between the two for other cities. Parameters of the log-normal law are obtained by solving the corresponding two equations system for each city, and each distribution is discretised and renormalised to be a vector of probabilities. See S2 Text for all details of this synthetic setup.

In the synthetic experiments, the network is generated from an initial complete network with dummy links of weight $1$ until reaching $t_f=1500$, and with a unit link volume of $w_0 = 1$.

     
\paragraph{Real setup}

The real setup is done using the empirical network of ownership links. Urban areas are distributed according to their positions in the actual geographical space, and economic size and sector composition attributes are used. The socio-economic distance is constructed using information from the statistical modelling, by considering fixed-effect coefficients estimated for each pair of countries. See S2 Text for more details on the construction of the socio-economic distance matrix.

The initial network is the same than in the synthetic setup, and the real links are taken as targets for the generated network. We constrain the total volume of flows by setting $w_0 = \sum_{ij} w_{ij}^{(obs)} / t_{f}$ when the number of time steps $t_f$ is given as a parameter.

\subsection*{Model parameters and indicators}

The model parameters are the Cobb-Douglas weights $\gamma_O,\gamma_D,\gamma_W,\gamma_S$ and distance decay parameters $d_0,c_0$. As the model also includes path-dependencies by integrating the influence of previous links, it cannot be reduced to a simple statistical model. Finally, the role of space introduces even further complexity. These aspects yield a generative model, in the sense that the successive states have to be simulated \cite{epstein1999agent}.

We consider two main geographical phenomena and therefore two macroscopic indicators to quantify the generated network. Firstly, geographical structures are captured by internationalisation of city-interactions in the context of intensification of globalisation and transnational city networking at the worldwide level \cite{taylor2001specification}. Hence we define the internationalisation indicator as the modularity of countries in the network. The situation of a minimised modularity corresponds to dense connections between cities of different countries in Europe and sparse connections between cities of the same European country. In practice, modularity is computed as follows
\begin{equation}
    I = \frac{1}{2 \left|E\right|} \cdot \sum_{i,j} \left(w_{ij} - \frac{d_i d_j}{2 \left|E\right|}\right) \mathbbm{1}_{c_i = c_j}
\end{equation}
where $d_i$ is the weighted degree of city $i$ in country $c_i$.

Secondly, we consider the geographical process of metropolisation. The later can be defined as a concentration of population and major economic decision functions in metropolises, in particular at the world-system level \cite{sassen1991global}. Metropolises playing the role of gateways of globalisation, are competing between each other to attract the most skilled workers and innovative industries \cite{RozenblatPumain2007}. Metropolisation gradients have been linked in the literature on systems of cities to several economic and political aspects \cite{RozenblatPumain2018} \cite{PumainRozenblat2019} \cite{Zdanowskaetal2020}. We introduce in this paper a metropolisation indicator defined as the correlation between the weighted degree and the GDP of the city, in order to capture the effect of large cities, or metropolises of regional importance, attracting the biggest amount of links and involved in a high number of interactions with other cities.  The later is computed using a Pearson correlation estimator on logarithms as follows:
\begin{equation}
    M = \hat{\rho} \left[\log (d_i) , \log (E_i) \right]
\end{equation}

In addition, we also consider an indicator giving insight of the structure of the network: this is the average size of communities obtained with a modularity optimisation algorithm (weighted Louvain algorithm \cite{blondel2008fast}). This is complementary to internationalisation, as it captures the endogenous structure of the network and the average size of international business clusters.


\subsection*{Empirical data}

We base our study on empirical data from the \emph{AMADEUS} dataset produced by the Bureau Van Dijk (BVD) on transnational firms in Europe. \emph{AMADEUS} provides a precise location, turnover and activity codes for owners and owned companies in all sectors in Europe. The Bureau Van Dick gathers, homogenizes and completes the information on these firms from national sources, publications of consultancies and audit firms such as KPMG, Deloitte, PricewaterhouseCoopers (PwC), Ernst \& Young (EY), Mazars, and those of other financial organisations such as Moody's, Fitch, Standard \& Poor's, Thomson Reuters or Duns and Bradstreet. A representativity study shows that \emph{ORBIS} --the Bureau Van Dijk's dataset for firms at the worldwide scale--, captures around 10 percent of existing foreign direct investments in 2011 in Poland \cite{Zdanowska2018}. \cite{bajgar2020coverage} find that the coverage of the \emph{ORBIS} database on OECD countries is a representative sample, but with a better performance on larger firms. As we aggregate company turnovers on urban areas in our analysis, we thus do not expect much representativity bias in the inter-urban network.

Companies from \emph{AMADEUS} are georeferenced using the Geonames database (using postcode or address depending on the information available). We then join this data with the Global Human Settlement dataset GHS-FUA for Functional Urban Areas \cite{Florczyk2019ghs} -- which delineate the commuting areas for urban centres. Starting from a firm-level dataset of 1,562,862 nodes and 1,866,936 links, we obtain a directed network of 573 urban areas and 9323 ownership links. The weight of links is obtained by computing the owned share of turnover at destination, i.e. $w_{ij} = \sum_{k \in i,l \in j} p_{kl} \cdot T_l$ where $p_{kl}$ is the ownership share of company $l$ by company $k$ and $T_l$ is the turnover of company $l$. Node attributes include the economic size of urban areas, that we compute as the sum of turnovers of companies within the area. This quantity is highly correlated with the GDP of the area-level included in the GHS database (Spearman correlation $\rho = 0.71$) and also with population ($\rho = 0.60$). Another attribute of the nodes is the industrial sector composition, expressed as a proportion of turnover in the area associated to a given industrial sector. Detailed sectors of firms are available up to the four digits of the NACE classification in the raw data \cite{EUROSTAT2008}. We consider the first level classification (21 categories) and compute sector proportions accordingly. This allows us to define an industrial proximity matrix between urban areas, taking a cosine similarity between vectors as $s_{ij} = \sum_{k=1}^{K} S_{ik}\cdot S_{jk}$ where $S_{ik}$ are sector proportions.

The urban network is sparse with a density of around $0.028$. It has heavy tail weighted degree and edge weight distributions, as shown in Fig.~\ref{fig:nwdist}. We fit power law and log-normal distributions, including minimal value cutoff following \cite{clauset2009power}, using the \texttt{powerlaw} R package \cite{powerlawpackage}. For both, log-normal distributions appear to be a better fit ($\mu=18.8$, $\sigma=2.3$ for weighted degree; $\mu=13.8$, $\sigma=2.8$ for edge weight), and include a much broader range of empirical distributions with lower estimated cut-offs. These heavy tail properties suggest the relevance of a generative model including self-reinforcing processes, which are known to produce such distributions.

%%%%%%%%%%%%%
\begin{figure}
    \begin{center}
        \includegraphics[width=\linewidth]{figures/Fig1.png}
    \end{center}
    \vspace{2cm}
    \caption{Distributions of network properties. \textit{(Left)} Cumulative distribution for edge weight, with power law fit (red) and log-normal fit (green); \textit{(Right)} Cumulative distribution for weighted degree.}
    \label{fig:nwdist}
\end{figure}
%%%%%%%%%%%%%


To focus on the community structure of the network, we test different modularity maximisation algorithms ran on the undirected corresponding network. The Louvain algorithm \cite{blondel2008fast} provides an undirected modularity of $0.388$, with 19 communities. The corresponding directed modularity computed following \cite{nicosia2009extending} is $0.362$. The greedy algorithm of \cite{clauset2004finding} results in 35 communities for a undirected modularity of $0.376$ and an directed modularity of $0.352$. In comparison, when taking as communities 29 existing countries, the corresponding directed modularity is $0.323$. This indicates that the structure of flows present certain regional patterns. Indeed, a null model assigning random labels with 30 communities, bootstrap 1000 times, yields an average modularity of $0.050 \pm 0.0017$, confirming the statistical significance of these communities. We show in Fig.~\ref{fig:fig2} a map of the communities obtained.

The communities reflect characteristic socio-cultural structures and cross-border economic ties throughout Europe. Cities in France, Belgium and Luxembourg belong to the same cluster as they share French as a common business language, but also cross-border tax arrangements creating easier economic interactions \cite{DecovilleDurand2019}. The same socio-cultural proximity effect is seen in cities of the United Kingdom and Ireland, and those of Sweden, Finland, Estonia, Latvia and Lithuania. The cluster composed of Dutch and Polish cities is justified by the fact that firms from the Netherlands are among the first foreign owners of polish firms since 2010 \cite{2020Zdanowska}. The cluster including cities in Germany, Czech Republic, Austria, Slovakia, Hungary and partly in Romania, find its origin in the dependence of the Central and Eastern European economies on German and Austrian large companies mostly from the automotive sector (i.e. Audi, Volkswagen). In addition, all cities of the later cluster have in common to be at the intersection of a very important freight transport route in Europe from Germany to Turkey \cite{Zdanowska2017}. 


%%%%%%%%%%%%%%
\begin{figure}
    \begin{center}
    \includegraphics[width=\linewidth]{figures/Fig2.png}
    \end{center}
    \caption{{\bf Map of network communities obtained by modularity maximisation.} We show communities with the higher modularity, obtained with the Louvain algorithm. The area of circles gives the turnover within the Functional Urban Area, and colour the community it belongs to. Urban Areas in communities of size smaller than 3 were not coloured for readability. Made with Natural Earth Data \cite{naturalearth}.}
    \label{fig:fig2}
\end{figure}
%%%%%%%%%%%%%%

Macroscopic indicators of internationalisation and metropolisation can also be computed on the empirical network. Internationalisation corresponds to the modularity of countries in the network, which was computed above as $I = 0.32$. Metropolisation computed with turnover has a very high empirical value $M = 0.961$ (95 \% confidence interval $\left[ 0.954 ; 0.967\right]$). A variation of this indicator computed with GDP from the GHSL database still shows a relatively high correlation ($0.776 \left[ 0.736 ; 0.811\right]$). In practice, this European urban network is thus highly internationalised and metropolised, following what can be expected from the empirical literature on urban networks.


\subsubsection*{Statistical analysis}

In order to understand the most determining geo-economic factors influencing the creation of links between cities, we run a statistical analysis as applied in the case of unconstrained spatial interaction models \cite{wilson1975some}. We test five different statistical models, which progressively include the processes for the generative network model. The most general statistical one is:

\begin{equation}
\log(w_{ij}) = \log(d_{ij}) + \log(T_i) + \log(T_j) + \log(s_{ij}) + \alpha_{c_i,c_j} + \varepsilon_{ij}
\end{equation}
where $\alpha_{c_i,c_j}$ is a fixed effect term for the coupling of countries $c_i,c_j$, and $T_i$, $T_j$ correspond to the turnovers of cities $i$ and $j$ respectively. 

This multiplicative form linearly transformed through logarithms is common practice for spatial interaction models. Note that no constraints are considered, since links include information about the turnover and a share of ownership at the same time. Estimation results are given in Table~\ref{tab:reg}. We also fit a Poisson generalised linear model with a logarithmic link on the rounded weights \cite{flowerdew1988fitting}. The findings show that when only distance is taken into account (model 1), it has a significant negative effect on link creation, but with an explained variance close to zero. Model 2 adds fixed effects by pair of countries, for which around a third are significant, and with a better $R^2$ of 0.17. Adding the economic size at origin and destination (turnovers $T_i$ and $T$, model 3) slightly improves the explanatory power (model 3). The best model in terms of explained variance ($R^2 = 0.31$) among the linear ones is the model 4, which includes all factors and fixed effects. This model also have the lowest Akaike Information Criterion (AIC) among the comparable linear models, meaning that the fit improvement is not due to overfitting. Model 5, which is a Poisson model with all variables is much a better fit regarding pseudo-$R^2$ and provides more significant estimates (all fixed effects significant and smaller standard deviations).

To investigate the role of missing links in these results (these have been removed since previous models are fitted on logarithms), we fit extended statistical models for count data focused on the role of zeros. Two different flavors of such models are: the hurdle model \cite{mullahy1986specification}, which corresponds to a conditional count model; and a zero-inflated Poisson model \cite{lambert1992zero}, which mixes a count model with an additional component to generate zeros. Full estimation results using \cite{zeileis2008regression}, are shown in S2 Text. As the network is rather sparse, these more detailed statistical models do not perform better than more simple models, as missing links are difficult to predict. The best zero-inflated model has a $R^2 = 0.16$, and it is similar to the performance of the best hurdle moel $R^2 = 0.17$.


Across all models, consistent qualitative stylised facts regarding link creation between cities are revealed: (i) distance has a negative influence; (ii) economic sizes have a positive effect, with the size of the origin city being more important (this is consistent within the ownership links context, as these are strongly driven by decisions at the headquarter/owner level); (iii) industrial proximity has a positive influence, i.e. similarity is more important than complementarity for this dimension; (iv) a large part of country fixed-effects are statistically significant; and (v) the order of magnitude of the influence of each factor is roughly the same, which means that no process totally dominates the others.

This preliminary analysis confirms the relevance of including all these different dimensions in the generative network model, since they have a comparable explanatory role in statistical models.


%%%%%%%%%%%%%
\begin{table}[!ht]
\begin{adjustwidth}{-1in}{0in}
\caption{{\bf Statistical models.} Ordinary Least Square estimations of statistical models explaining $\log(w_{ij})$ (standard errors in parenthesis). ***, ** and * respectively indicate 0.01, 0.05 and 0.1 levels of significance. For the fixed effect by origin-destination pairs of countries, the proportion of significant coefficients is attributed (where $p<0.1$). Models (1) to (4) are ordinary least square models, while model (5) is a Poisson generalised linear model with logarithmic link. We compare model performance using $R^2$, Mean Square Error, and Akaike Information Criterion. For the Poisson model (model 5), AIC is not given as it is not comparable. \label{tab:reg}}
\medskip
\begin{tabular}{|l|c|c|c|c|c|}
\hline
Model  & (1) & (2) & (3) & (4) & (5) \\ 
\hline
$\log(d_{ij})$ &      -0.06** (0.03) &   -0.11** (0.05)  & -0.41*** (0.02)  & -0.35*** (0.04)  &  -0.26*** ($5\cdot 10^{-6}$) \\
$\log(T_i)$ &   &   & 0.56*** (0.01) &  0.56*** (0.01) & 0.79*** ($2\cdot 10^{-6}$) \\
$\log(T_j)$ &     &   & 0.39*** (0.01) &  0.39*** (0.01) & 0.66***  ($1.5\cdot 10^{-6}$) \\
$\log(s_{ij})$ &     &   &  &  0.19*** (0.07) & 0.53*** ($9\cdot 10^{-6}$)  \\
Countries &    &  28.3\% &   &  26.5\% & 100\% \\
\hline
$R^2$ &       0.00059   &  0.17 & 0.21 &  0.31  &  0.56 \\
MSE & 7.75 & 6.84 & 6.10 & 5.33 & 8.72 \\
AIC &        44304   &  43578  &  42131  & 41917 &   \\
\hline
\end{tabular}
\end{adjustwidth}
\end{table}
%%%%%%%%%%%%%





\section*{Model exploration and calibration}

The model is implemented in NetLogo, which provides a good compromise between performance and interactive prototyping and exploration \cite{railsback2017improving}. Numerical experiments are done by integrating the model into the OpenMOLE software for model exploration and validation \cite{reuillon2013openmole}. This platform implements sensitivity analysis and calibration methods and offers a transparent access to high-performance computing infrastructures, from local servers to clusters and computing grids. The model source code, the aggregated network data (the raw initial firm network cannot be made available for data ownership reasons), and the results are available on the open Git repository of the project at \url{https://github.com/JusteRaimbault/ABMCitiesFirms}. Large simulation result files are available on the dataverse repository at \url{https://doi.org/10.7910/DVN/UPX23S}. We show in Fig.~\ref{fig:fig3} examples of generated networks, with very contrasted patterns obtained with different spatial interaction ranges. Low values of the gravity decay parameter yield local networks around main cities, while long interaction ranges yield more integrated networks. The same results can be observed for the networks generated using the real data in the lower panels.


%%%%%%%%%%%%%
\begin{figure}
    \begin{center}
        \includegraphics[width=\linewidth]{figures/Fig3.png}
    \end{center}
    \caption{Example of simulated networks at $t=1500$, for a synthetic system of cities (Top row) and the European urban network (Bottom row), with a high (resp. low) gravity decay parameter for the left column (resp. right).\label{fig:fig3}}
\end{figure}
%%%%%%%%%%%%%


\subsection*{Synthetic city systems}

We first study extensively the behaviour of the model on synthetic systems of cities, to isolate its intrinsic behaviour independently of a contingent geographical situation.

\paragraph{Sensitivity analysis}

A global sensitivity analysis first unveils an aggregated influence of parameters on model indicators. We apply Saltelli's Global Sensitivity method introduced by \cite{saltelli2008global}. This produces values for each parameter and each output of a first order sensitivity index, defined as $Var\left[\mathbb{E}_{\mathbf{X}_{\sim i}}\left(Y_j | X_i\right)\right] / Var\left[Y_j\right]$, for parameter $X_i$ and output $Y_j$, $\mathbf{X}_{\sim i}$ being all other parameters. This captures the total influence of $X_i$ all other things being equal. The total order index is given by $\mathbb{E}_{\mathbf{X}_{\sim i}} \left[Var(Y_j | \mathbf{X}_{\sim i})\right] / Var\left[Y_j\right]$ and captures non-homogeneity in behaviour and interaction between parameters. Indices were estimated with a Sobol sequence sampling of 20,000 model runs \cite{saltelli2010variance}. We give in S2 Text the full estimated results for sensitivity indices. To summarize, we find that indicators related to modularity (internationalisation and optimal modularity) are mostly influenced by geographical parameters. On the contrary, indicators of network structure are driven by origin and destination sizes. The influence of sectors and historical links has a secondary but not negligible role. Altogether, the analysis shows strong interaction effects between parameters, since for several indicators the total order index is one order of magnitude larger than the first order index. This means that the generative model captures some aspects of the complex behaviour of the system.



\paragraph{One factor sampling}

A first numerical experiment of one-factor sampling on all Cobb-Douglas parameters and 100 stochastic repetitions confirms a good statistical convergence (the average Sharpe ratios for the indicators are all larger than 5). We thus use 20 repetitions in the following larger experiments (in the case of a normal distribution, a 95\% confidence interval on the average is of size $2\sigma \cdot 1.96 / \sqrt{n}$, what gives $n=16$ repetitions for a CI of width of the standard deviation). The behaviour of some indicators are shown in Fig.~\ref{fig:fig4}. For example, internationalisation and metropolisation both show a transition as a function of $d_0$, from a local to a global regime. The sector proximity parameter $\gamma_S$ has a linearly increasing influence on internationalisation. On the contrary, it induces a maximum for metropolisation, what can be interpreted as the fact that too few or too much specialisation leading to less integrated cities in terms of metropolisation.


%%%%%%%%%%%%%
\begin{figure}
	\begin{center}
	    \includegraphics[width=\linewidth]{figures/Fig4.png}
	\end{center}
    \caption{(Top Left) Internationalisation index decreases exponentially with gravity decay; (Top Right) Correlation between city weighted degree and size. Both plots show a transition from a local to a global regime. (Bottom Left) Internationalisation varies linearly with sector proximity $\gamma_S$; (Bottom Right) Metropolisation exhibits a maximum at $\gamma_S \simeq 1.2$, suggesting an intermediate regime where specialisation has more influence. \label{fig:fig4}}
\end{figure}
%%%%%%%%%%%%%



\paragraph{Grid exploration}

The model behaviour is then studied with a grid sampling for parameters and 20 repetitions (the computations are run on the European Grid Infrastructure, and are equivalent to 2.5 years of CPU time). The distance decay and sector parameters are varied with 10 steps, other parameters with three. The influence of the gravity decay parameters is confirmed when plotting the internationalisation index against the distance, which exhibits an exponential decay as shown in Fig.~\ref{fig:fig5}. We show that the size of the origin and the sector proximity also have a significant effect, although the latter only becomes relevant when the size of the origin has a strong influence (third panel).


%%%%%%%%%%%%%%
\begin{figure}
    \includegraphics[width=\linewidth]{figures/Fig5.png}
    \caption{The transition as a function of the interaction range depends on the influence of the origin size $\gamma_O$; the sector proximity $\gamma_S$ plays a role only for a large influence of the origin.\label{fig:fig5}}
\end{figure}
%%%%%%%%%%%%%%

Other indicators exhibit non-trivial patterns. For example, when considering the average community size of the final network as shown in Fig.~\ref{fig:fig6}, we obtain a maximal integration in terms of the communities at an intermediate value of the gravity decay parameter. This can be interpreted as the emergence of a regional regime. The size of the communities is largely influenced by the value of the elasticities for the similarity function and the ratio of the economic output of the area. In particular, we observe a qualitative inversion of the role of $\gamma_S$ when introducing an effect of the origin (switching $\gamma_O$ from 0 to 1, first panel to second panel). The maximal community size disappears when $\gamma_O = 2$, implying a regime with small local communities where large cities mostly connect with their hinterland. These experiments show the diverse stylised facts that the model is capable of producing, while at the same time they reveal the complex interplay between the different processes involved.

%%%%%%%%%%%%%%
\begin{figure}
    \includegraphics[width=\textwidth]{figures/Fig6.png}
	\caption{Maximal integration in terms of the community size is achieved at an intermediate value of d$_o$: emergence of a regional regime; the maximal size depends on the role of the sectors $\gamma_S$ in a decreasing way when the origin size is deactivated, and in an increasing way when $\gamma_o=1$; this regime disappears when the influence of the origin size becomes too large.\label{fig:fig6}}
\end{figure}
%%%%%%%%%%%%%%


\paragraph{Impact of urban hierarchy}

We run a specific experiment to study the impact of the urban hierarchy on firms dynamics. Rank-size law in cities is a central stylized fact within urban theories, despite the discussions regarding the estimation of the power-law exponent, its actual values and its variation depending on the definition of cities considered \cite{cottineau2017metazipf,corral2020truncated}. I this particular context, understanding how this parameter can impact urban dynamics within artificial systems of cities -- in which it can be modified to extreme values non observable in real systems--, should help disentangling the variability due to model parameters from the variability due to the specific configuration of the urban system \cite{raimbault2019space}. We change the initial hierarchical exponent $\alpha$ from 0.1 to 2.0 with a step of 0.1, and also vary the interaction range $d_0$. The behaviour of the internationalisation and metropolisation indicators are shown in Fig.~\ref{fig:fig7}. As expected, the hierarchy of the urban system has an important impact on model outcomes. We find that more hierarchical urban systems tend to produce more international networks (recall that the internationalisation indicator corresponds to the modularity, the latter is minimized when the networks span more across different countries). This is consistent with the existence of globalised metropolis \cite{sassen1991global}. This effect is mitigated by reducing the interaction ranges. Regarding metropolisation, we observe the existence of maxima as a function of the initial hierarchy across different interaction ranges $d_0$. This means that a too high hierarchy is detrimental to the global metropolisation when considering all cities, what may be due to the fact that in such a case very large cities are capturing all flows, leaving nothing to intermediate and medium-sized cities. Interestingly, the optimal value $\alpha \simeq 1.1$ is not far from the observed values (which usually range between 0.9 and 1.1 but can take larger values such as 1.5 when extending the urban system \cite{Raimbault_2020}), implying that this optimality property is endogenous to the emergence of urban systems and linked to their intrinsic hierarchy.



%%%%%%%%%%%%%
\begin{figure}
    \begin{center}
        \includegraphics[width=\linewidth]{figures/Fig7.png}
    \end{center}
    \caption{\textbf{Impact of the urban hierarchy.} (Left) Internationalisation as a function of the initial synthetic hierarchical exponent $\alpha$, for different values of the interaction range $d_0$ (color); (Right) Metropolisation as a function of $\alpha$, for different values of the interaction range $d_0$ (color).\label{fig:fig7}}
\end{figure}
%%%%%%%%%%%%%



\subsection*{Model calibration on the European urban network}

% TODO precise calib setting + details on rescaling
We then apply the model to a real system of cities by calibrating it on the European ownership network. The model setup is done following the real setup described above. The number of time steps $t_f$ is left as an additional parameter, which in a sense determines the granularity of the cumulative network generation process.

The model is fitted at the microscopic level on the link structure: the objective functions for calibration are the average mean squared error on logarithms of weights given by

\begin{equation}
\varepsilon_L = \frac{1}{N^2} \sum_{i,j} \left(\log w_{ij} - \log \hat{w}_{ij} \right)^2
\end{equation}
where $\hat{w}_{ij}$ are the simulated weights, and the logarithm of the mean squared error (MSE)

\begin{equation}
\varepsilon_M = \log\left(\frac{1}{N^2} \sum_{i,j} \left(w_{ij} - \hat{w}_{ij}\right)^2 \right)
\end{equation}

These two indicators capture the overall model performance with the logarithm of MSE, but also performance on medium-sized and small links, and are therefore complementary as shown in the case of cities population dynamics by \cite{raimbault2018indirect}. A calibration on macroscopic indicators of metropolisation and internationalisation would not bring much knowledge on model processes, since several points from the grid experiment above - not designed for this - already provide a good performance (19 parameter points out of 6534 are simultaneously below a relative error of 10\% on internationalisation and below 10\% on metropolisation).

Calibration is done using a genetic NSGA2 algorithm \cite{deb2002fast}, which is particularly suited for such a bi-objective calibration of a simulation model. Stochasticity is taken into account by adding the estimation confidence as an additional objective, and we filter the final population to have at least 20 samples. We use a population of 200 individuals and run the algorithm for 50,000 generations, on 1000 islands in parallel.


%%%%%%%%%%%%%%
\begin{figure}
	\begin{center}
    \includegraphics[width=0.75\linewidth]{figures/Fig8.png}
    \end{center}
	\caption{\textbf{Model calibration results.} Pareto front obtained for the bi-objective model calibration for $\varepsilon_L$ and $\varepsilon_M$ objectives. $\varepsilon_L$ can be compared to the MSE of statistical models fitted above, and the generative model outperform these for several parametrisations (lowest MSE 5.33 for statistical models). Point size gives the number of stochastic samples and color the value of $\gamma_O$.\label{fig:fig8}}
\end{figure}
%%%%%%%%%%%%%%


We show in Fig.~\ref{fig:fig8} the calibration result, as a Pareto front of compromise points between the two objectives. As the mean squared error on logarithm is the same than the one for statistical models, it can be directly compared. The other objective would correspond to statistical models directly on variables: therefore, our model covers in a sense a set of intermediate models which make a compromise between the two objectives, and is therefore much more flexible. The values for $\varepsilon_L$ are for a large proportion of points lower than for statistical models, our model outperforms these in this predictive sense. As shown in Fig.~\ref{fig:fig8}, increasing values for $\gamma_O$ lead to better performance regarding $\varepsilon_L$: increasing the importance of the origin will provide a better fit on all orders of magnitude of the link weights (while $\varepsilon_M$ favours mostly the largest links given the fat-tail distribution).

When considering optimal points with $\varepsilon_L < 5.0$, the adjusted parameters are: long range gravity interactions and socio-economic interactions given by $d_0 = 5972 \pm 2148$ and $c_0 = 113 \pm 33$ (the maximal $c_{ij}$ is 11.8); a stronger influence of the destination than of the origin as $\gamma_O = 1.46 \pm 0.10$ and $\gamma_D = 2.0 \pm 0.05$; a comparable influence of sectors as $\gamma_S = 1.76 \pm 0.21$; a fine time granularity as $t_f = 4951 \pm 124$; and a very strong influence of previous links as $\gamma_W = 6.43 \pm 4.11$. This last point furthermore shows in particular the importance of including path-dependency in this complex generative model. The interaction of this process with others implies an inversion of the relative importance of origin and destination (in opposition to the statistical models). The fact that calibrated interaction distances are large is consistent with long range economic interactions within Europe. Besides these stylized facts, these calibration results altogether demonstrate the feasibility of the application of the model to real data. As stated previously, the model is not predictive and the relatively high error values would not make it satisfactory in that manner, but are reasonable for its explanatory and application functions.


\section*{Application: impact of economic shock}

Let us design scenarios to evaluate the impact of economic shocks. These can be the consequence of diverse factors, including socio-economic, geopolitical factors (the example of Brexit), or other unpredicted human disasters such as the COVID-19 pandemic. We introduce the shock of the latter by simulating border closures by rescaling $c_0$ -- the range parameter for socio-economic interactions --, and intra-country lock-downs by rescaling $d_0$ -- the range parameter for direct interactions -- leaving other parameters fixed to their default values, and the model setup in the real configuration. More precisely, with $t_f = 5000$, the model is run for $t_f / 2$ steps. Then, we introduce the effect of the shock through two new rate parameters $\kappa_C \in \left[0;1\right]$ and $\kappa_G \in \left[0;1\right]$, such that the model parameters are updated as $d_0 = \kappa_G \cdot d_0$ and $c_0 = \kappa_C \cdot c_0$. The model is then run for the remaining time steps until $t_f$. We study the temporal trajectory of indicators to see the impact of the shock in time. The experiment is run for $(\kappa_G,\kappa_C)$ ranging between 0.2 (strong restrictions) to 1 (reference trajectory), with 100 model repetitions.

Results are shown in Fig.~\ref{fig:fig9}. We find an important impact of the shock on internationalisation, but less on the average community size. The impact of changing $d_0$ is more important than $c_0$, but a combination of both yields the stronger effect. For minimal values of $\kappa_G$ and $\kappa_C$, internationalisation is more than doubled, confirming a reconfiguration of urban networks within countries. We validate the statistical significance of effects observed in Fig.~\ref{fig:fig9} by comparing distributions with Kolmogorov-Smirnov (KS) tests. More precisely, we proceed for each indicator and value of $(\kappa_G,\kappa_C)$ to a two-sided KS test between the statistical distribution of the indicator over repetitions at the final time with the distribution in the reference configuration. For internationalisation, p-values of the test are all smaller than 0.002 for $\kappa_D < 0.6$ but larger than $0.15$ for $\kappa_D \geq 0.6$. This means that the shock has a statistically significant impact only when the interaction range is more than halved. For community size, significance (p-value smaller than 0.01) is reached only for the smallest value $\kappa_D = 0.2$. Thus, the trajectory of the urban network is rather resilient to moderate shocks. This application shows how the model could be applied to practical policy issues.


%%%%%%%%%%%%%%
\begin{figure}
	\begin{center}
    \includegraphics[width=\linewidth]{figures/Fig9.png}
    \end{center}
	\caption{\textbf{Application of the calibrated model to an economic shock scenario.} All plots show the trajectory of indicators (internationalisation for the top row and average community size for the bottom row) in time, for different values of interaction decay rescaling $\kappa_G$ (color) and socio-economic distance rescaling $\kappa_C$ (panels). The vertical dotted red line shows the moment the economic shock is introduced and $d_0$ (respectively $c_0$) is set to $\kappa_G \cdot d_0$ (resp. $\kappa_C \cdot c_0$).\label{fig:fig9}}
\end{figure}
%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%
\section*{Discussion}

This paper aimed at presenting a generative model for urban networks defined by interactions between firms based on synthetic data, simulated via the OpenMOLE platform and calibrated on real data on ownership linkages of firms for Europe from the Amadeus dataset. The simulation on a synthetic system of cities provides a broad knowledge on model behaviour in its parameter space. Even in such a simple model (close to directly tractable stationary state) the behaviour is highly non-linear in many dimensions. Our study shows how crucial model exploration is to overcome hidden parameters (deactivated mechanisms or default parameter values). This paper highlights the fact that the exploration of the intrinsic dynamics on synthetic data is of great importance and should be driven before an application on real data, in order to set aside the geographical effects in the model dynamics.

The calibration of the model suggests its potential application to policy issues and can therefore have practical applications in the future. For example the effect of exogenous shocks in the socio-economic structure can be tested as we did in the stylized application example above. Such shocks can for example be the upcoming impact of Brexit on the European market or the consequence of a long-term closure of the European Union members' borders due to further pandemic outbreaks on the single market. In this sense the UK economic sectors mostly dependent on foreign capital and generating the highest turnovers in 2018, that would be the most affected and worth examining in detail are: the extraction of crude petroleum, the manufacture of tobacco products and of basic pharmaceutical goods (in terms of out-going links from the UK) ; the activities of head offices and holding companies, the sale of cars and manufacture of motor vehicles (in terms of in-going links to the UK). We showed in our experiment that although the system is resilient to moderate shocks, strong restrictions have an important impact on internationalisation and thus can be expected to have a detrimental effect on the UK economy due to these foreign ownership links (see also S1 Text\ref{S1Text}). The impact of such unforeseen economic shocks could also be considered from a multi-level perspective, coupling our work with other approaches such as \cite{Dorretal2022} studying the firm-level impact of the Covid crisis.

Several possible extensions of the current work can be undertaken in the future. A simple extension with additional processes could include for example: (i) self-connections to account for links within FUAs; (ii) edge deletion which would capture the sell of subsidies to other companies; (iii) a precise study of the role of path dependency should also be undertaken in order to anticipate the creation of future links; (iv) other formulations of the generative model might be taken into consideration as other approaches to combine factors such as multi-objective optimisation depending on sectors using Pareto fronts; (v) allow for a dynamical calibration with a more detailed realistic representation of temporal dynamics, accounting for temporal non-stationarity for example.

We also suggest that our simple agent-based model can be a basis for or a component of more complicated economic agent-based models. A co-evolution model with an evolution of city sizes in parallel to the firm network would be more realistic for an application on longer time scales, but would also be more difficult to parametrise and calibrate \cite{raimbault2018characterising}. A model with additional firm agents would lead to a multi-scale agent-based model, with also more flexibility for policy applications. The link with data could also be more elaborated: indeed the statistical analysis does not include spatial or neighborhood effects, and spatial non-stationarity may be accounted for using Geographically Weighted Regression models for example \cite{comber2021route}, to then be coupled with the ABM in an hybrid approach. Finally, an adaptation at the world scale using for example urban regions and data explored by \cite{rozenblat2021intra}, would be an extension with important practical and theoretical potentialities. 


\section*{Supporting information}

\subsection*{S1 Text: UK's economic sectors dependent on international links.}
\label{S1Text}

Summary of links between UK and the rest of the EU, by economic sector.

\subsection*{S2 Text: Statistical models, generative model setup and sensitivity analysis.}
\label{S2Text}

Details on the empirical analysis and the simulation model:

\begin{itemize}
    \item additional zero-inflated and hurdle statistical models;
    \item summary statistics for the socio-economic distance matrix;
    \item procedure for the synthetic model setup;
    \item Global Sensitivity Analysis
\end{itemize}



\section*{Acknowledgments}

Results obtained in this paper were computed on the vo.complex-system.eu virtual organization of the European Grid Infrastructure (http://www.egi.eu). We thank the European Grid Infrastructure and its supporting National Grid Initiatives (France-Grilles in particular) for providing the technical support and infrastructure. We also acknowledge the funding of the EPSRC grant EP/M023583/1.


\bibliographystyle{plos2015}
\bibliography{biblio}




\end{document}
