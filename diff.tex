\documentclass[10pt,letterpaper]{article}
%DIF LATEXDIFF DIFFERENCE FILE
%DIF DEL misc/paper_v1.tex   Thu May 12 17:43:34 2022
%DIF ADD main.tex            Mon May 30 17:51:44 2022
\input{header.tex}

\usepackage{ragged2e}
%DIF PREAMBLE EXTENSION ADDED BY LATEXDIFF
%DIF UNDERLINE PREAMBLE %DIF PREAMBLE
\RequirePackage[normalem]{ulem} %DIF PREAMBLE
\RequirePackage{color}\definecolor{RED}{rgb}{1,0,0}\definecolor{BLUE}{rgb}{0,0,1} %DIF PREAMBLE
\providecommand{\DIFadd}[1]{{\protect\color{blue}\uwave{#1}}} %DIF PREAMBLE
\providecommand{\DIFdel}[1]{{\protect\color{red}\sout{#1}}}                      %DIF PREAMBLE
%DIF SAFE PREAMBLE %DIF PREAMBLE
\providecommand{\DIFaddbegin}{} %DIF PREAMBLE
\providecommand{\DIFaddend}{} %DIF PREAMBLE
\providecommand{\DIFdelbegin}{} %DIF PREAMBLE
\providecommand{\DIFdelend}{} %DIF PREAMBLE
\providecommand{\DIFmodbegin}{} %DIF PREAMBLE
\providecommand{\DIFmodend}{} %DIF PREAMBLE
%DIF FLOATSAFE PREAMBLE %DIF PREAMBLE
\providecommand{\DIFaddFL}[1]{\DIFadd{#1}} %DIF PREAMBLE
\providecommand{\DIFdelFL}[1]{\DIFdel{#1}} %DIF PREAMBLE
\providecommand{\DIFaddbeginFL}{} %DIF PREAMBLE
\providecommand{\DIFaddendFL}{} %DIF PREAMBLE
\providecommand{\DIFdelbeginFL}{} %DIF PREAMBLE
\providecommand{\DIFdelendFL}{} %DIF PREAMBLE
%DIF END PREAMBLE EXTENSION ADDED BY LATEXDIFF

\begin{document}
\justify
\vspace*{0.2in}

\begin{flushleft}
{\Large
\textbf\DIFdelbegin %DIFDELCMD < \newline{Modeling growth of urban firm networks} %%%
%DIF <  Please use "sentence case" for title and headings (capitalize only the first word in a title (or heading), the first word in a subtitle (or subheading), and any proper nouns).
\DIFdelend \DIFaddbegin \newline{Modelling growth of urban firm networks}
\DIFaddend }
\newline
%DIF <  Insert author names, affiliations and corresponding author email (do not include titles, positions, or degrees).
\DIFdelbegin %DIFDELCMD < \\
%DIFDELCMD < %%%
\DIFdel{Juste Raimbault}\DIFdelend \DIFaddbegin 

\DIFadd{Juste Raimbault}\DIFaddend \textsuperscript{1,2,\DIFdelbegin \DIFdel{3*}\DIFdelend \DIFaddbegin \DIFadd{3,4 *}\DIFaddend },
Natalia Zdanowska\textsuperscript{\DIFdelbegin \DIFdel{1}\DIFdelend \DIFaddbegin \DIFadd{2}\DIFaddend ,\DIFdelbegin \DIFdel{3}\DIFdelend \DIFaddbegin \DIFadd{4,5}\DIFaddend },
Elsa Arcaute\textsuperscript{\DIFdelbegin \DIFdel{3}\DIFdelend \DIFaddbegin \DIFadd{2}\DIFaddend }
\\
\bigskip
\textbf{1} \DIFaddbegin \DIFadd{LASTIG, Univ Gustave Eiffel, IGN-ENSG, Saint-Mand}{\DIFadd{\'e}}\DIFadd{, France
}\\
\textbf{\DIFadd{2}} \DIFaddend Centre for Advanced Spatial Analysis, UCL, London, United Kingdom
\\
\textbf{\DIFdelbegin \DIFdel{2}\DIFdelend \DIFaddbegin \DIFadd{3}\DIFaddend } UPS CNRS 3611 ISC-PIF, Paris, France
\\
\textbf{\DIFdelbegin \DIFdel{3}\DIFdelend \DIFaddbegin \DIFadd{4}\DIFaddend } UMR CNRS 8504 G{\'e}ographie-cit{\'e}s, Paris, France
\\
\DIFaddbegin \textbf{\DIFadd{5}} \DIFadd{Luxembourg Institute of Socio-Economic Research, Esch-sur-Alzette, Luxembourg
}

\DIFaddend \bigskip

% Use the asterisk to denote corresponding authorship and provide email address in note below.
* juste.raimbault@polytechnique.edu

\end{flushleft}


\section*{Abstract}
The emergence of interconnected urban networks is a crucial feature of globalisation processes. Understanding the drivers behind the growth of such networks -- in particular urban firm networks --, is essential for the economic resilience of urban systems. We introduce in this paper a generative \DIFdelbegin \DIFdel{network }\DIFdelend model for firm networks at the urban area level\DIFdelbegin \DIFdel{including several complementary processes}\DIFdelend \DIFaddbegin \DIFadd{, which considers the following features}\DIFaddend : the economic size of \DIFdelbegin \DIFdel{urban areas at origin and destination, }\DIFdelend \DIFaddbegin \DIFadd{the areas representing the source and target nodes, the }\DIFaddend industrial sector proximity between firms, the strength of links from the past, as well as the geographical and socio-cultural \DIFdelbegin \DIFdel{distance}\DIFdelend \DIFaddbegin \DIFadd{distances between urban areas}\DIFaddend . An empirical network analysis on European \DIFaddbegin \DIFadd{urban }\DIFaddend firm ownership data confirms the relevance of each of these factors \DIFaddbegin \DIFadd{on new link creation}\DIFaddend . We then simulate network growth \DIFdelbegin \DIFdel{for }\DIFdelend \DIFaddbegin \DIFadd{on }\DIFaddend synthetic systems of cities, unveiling \DIFdelbegin \DIFdel{stylized }\DIFdelend \DIFaddbegin \DIFadd{stylised }\DIFaddend facts such as a transition from a local to a global regime or a maximal integration achieved at an intermediate interaction range. We calibrate the model on the European network, outperforming statistical models\DIFaddbegin \DIFadd{, }\DIFaddend and showing a strong role of path-dependency. \DIFdelbegin \DIFdel{Potential applications of the model include the study of mitigation policies }\DIFdelend \DIFaddbegin \DIFadd{The model is applied to stylised scenarios, opening up to the formulation of public policies recommendations }\DIFaddend to deal with exogenous shocks such as economic \DIFdelbegin \DIFdel{crisis or potential lockdowns of countries, which we illustrate with an application on stylized scenarios}\DIFdelend \DIFaddbegin \DIFadd{crises or potential lock-downs of countries}\DIFaddend .

\linenumbers

% Keywords
% Urban firm networks; Simulation model; Model calibration


\section*{Introduction}

Networks constitute the new social morphology of our societies, since the intensification of globalisation of the economy in the late 20th century \cite{castells2000networksociety}. A world-city system has since then emerged \cite{taylor2001specification}, \DIFdelbegin \DIFdel{characterized }\DIFdelend \DIFaddbegin \DIFadd{characterised }\DIFaddend by highly interconnected urban centres at the global level \DIFdelbegin \DIFdel{\mbox{%DIFAUXCMD
\cite{sassen1991}}\hspace{0pt}%DIFAUXCMD
}\DIFdelend \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{Sassen1991}}\hspace{0pt}%DIFAUXCMD
}\DIFaddend . These interactions can be of different nature and determined by economic, socio-cultural, or geopolitical proximity inducing spatial and non-spatial patterns \cite{martinus2018global}. Interactions of economic nature between transnational firms \cite{derudder2018central}, are together with international trade patterns among the most representative of the current economic trends \cite{taylor2001specification}. Understanding the drivers of growth and geographical properties of such an urban network, can be used to foster innovation in specific cities and to shape public policies for local industrial clusters \cite{turkina2016structure}. In addition, \DIFdelbegin \DIFdel{straightening these }\DIFdelend \DIFaddbegin \DIFadd{strengthening }\DIFaddend city-interactions can be crucial for revitalising certain geographical areas \cite{Clarke2018}\DIFdelbegin \DIFdel{, by developing strategic industries }\DIFdelend \DIFaddbegin \DIFadd{. This can be achieved through strategic development of certain industrial sectors }\DIFaddend for global integration of regions \cite{dawley2019creating}, cities \cite{gluckler2016relational} and countries \cite{martinus2019brokerage}. Exploring city/firm interactions \cite{storme2019introducing} and the position of cities within these networks \cite{gluckler2016relational} can also \DIFdelbegin \DIFdel{permit }\DIFdelend \DIFaddbegin \DIFadd{allow us }\DIFaddend to infer the consequences of \DIFdelbegin \DIFdel{future }\DIFdelend \DIFaddbegin \DIFadd{unforeseen }\DIFaddend exogenous shocks such as an economic crisis, a post-Brexit scenario for the European Union or a single market collapse in the post-COVID19 future.

\DIFdelbegin \DIFdel{The use of network }\DIFdelend \DIFaddbegin \DIFadd{Network }\DIFaddend models to understand processes underlying the emergence and dynamics of such networks \DIFdelbegin \DIFdel{has already been tackled }\DIFdelend \DIFaddbegin \DIFadd{have been proposed }\DIFaddend in the literature, \DIFdelbegin \DIFdel{but still not extensively and never explicitly at }\DIFdelend \DIFaddbegin \DIFadd{nevertheless, these are not extensive and do not explicitly model the }\DIFaddend city level \cite{taylor2001specification}. \DIFdelbegin \DIFdel{In fact }\DIFdelend \DIFaddbegin \DIFadd{At regional scale, }\DIFaddend generative urban network models combining geographical factors with network topological properties \DIFdelbegin \DIFdel{exist at the regional scale }%DIFDELCMD < {%%%
\DIFdel{\mbox{%DIFAUXCMD
\cite{dai2016simulating}}\hspace{0pt}%DIFAUXCMD
}%DIFDELCMD < }%%%
\DIFdel{. Trade }\DIFdelend \DIFaddbegin \DIFadd{have been proposed \mbox{%DIFAUXCMD
\cite{dai2016simulating}}\hspace{0pt}%DIFAUXCMD
. At country level, trade }\DIFaddend networks have been extensively studied from the complex networks perspective \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{garlaschelli2005structure}}\hspace{0pt}%DIFAUXCMD
}\DIFaddend , but these are generally \DIFdelbegin \DIFdel{driven at the country-level \mbox{%DIFAUXCMD
\cite{garlaschelli2005structure} }\hspace{0pt}%DIFAUXCMD
because of a }\DIFdelend \DIFaddbegin \DIFadd{not explored at a more granular level due to the }\DIFaddend lack of city-level data. \DIFaddbegin \DIFadd{Within this work, we contribute to the research at an interurban level, exploring the position and dynamics of cities in the socio-economic world-wide space \mbox{%DIFAUXCMD
\cite{pumain2018evolutionary} }\hspace{0pt}%DIFAUXCMD
\mbox{%DIFAUXCMD
\cite{berry1964cities}}\hspace{0pt}%DIFAUXCMD
, by considering the interactions between the firms in the cities. An extensive literature exists exploring firm-to-firm level networks in economic geography. For example, within the input-output models framework, these are used to study inter-sectors and inter-region transactions \mbox{%DIFAUXCMD
\cite{Rodriguesetal2016}}\hspace{0pt}%DIFAUXCMD
, or firm level productivity, to understand macroeconomic level outcomes \mbox{%DIFAUXCMD
\cite{Grassi2016} }\hspace{0pt}%DIFAUXCMD
and economic resilience \mbox{%DIFAUXCMD
\cite{Ialongo2021}}\hspace{0pt}%DIFAUXCMD
. At a more granular level, urban firm networks have been investigated in complexity science \mbox{%DIFAUXCMD
\cite{RozenblatNeal2021} }\hspace{0pt}%DIFAUXCMD
to unveil agglomeration economies and competitiveness of cities \mbox{%DIFAUXCMD
\cite{Rozenblat2010}}\hspace{0pt}%DIFAUXCMD
, regionalisation patterns \mbox{%DIFAUXCMD
\cite{Rozenblatetal2017} }\hspace{0pt}%DIFAUXCMD
or to model hierarchy and specialisation \mbox{%DIFAUXCMD
\cite{BidaRozenblat2020}}\hspace{0pt}%DIFAUXCMD
. Moreover economic complexity indicators have been developed in this sense to characterise the production structure and specialisation of different countries due to economic activity, including those of trade firms \mbox{%DIFAUXCMD
\cite{HaussmanHidalgo2009,OCleary2016}}\hspace{0pt}%DIFAUXCMD
. This work complements this effort by proposing a generative mechanism of such networks. 
}

\DIFadd{Another contribution of the present study is the derivation of geographical and economic processes such as internationalisation and metropolisation of cities, through the proposed generative model of firm networks, where weights of cities are given by shares of turnovers generated by ownership links between firms. Previous literature considers mostly weights as GDP of countries, for example in gravity models of export-import firms networks \mbox{%DIFAUXCMD
\cite{Kepaptsogloual2010} }\hspace{0pt}%DIFAUXCMD
\mbox{%DIFAUXCMD
\cite{MinondoRequena2013}}\hspace{0pt}%DIFAUXCMD
. }\DIFaddend Input-output models, mostly used in regional science to represent flows between geographical areas, are considered in some cases as a type of urban generative model \cite{jin1993generation}. In this stream of research, spatial interaction models \cite{dennett2013multilevel} can form the basis of urban network models for different types of flows \cite{dai2016generative} or \DIFaddbegin \DIFadd{for the }\DIFaddend physical infrastructure \cite{raimbault2018indirect} \DIFdelbegin \DIFdel{.
}\DIFdelend \DIFaddbegin \DIFadd{at different geographical scales. 
}\DIFaddend 

\DIFdelbegin \DIFdel{In this paper we choose to focus on urban networks of firms to question and capture geographical and economic processes as internationalisation, metropolisation, regionalisation and specialisation of cities within a generative model. 
}\DIFdelend The specific question we tackle is the complementarity of \DIFaddbegin \DIFadd{the }\DIFaddend different processes to generate \DIFdelbegin \DIFdel{such urban networks. The originality of the present paper is to examine these issues within the system of cities framework \mbox{%DIFAUXCMD
\cite{berry1964cities}}\hspace{0pt}%DIFAUXCMD
. In this approach the position and dynamics of cities in the socio-economic world-wide space can be considered by their interactions with other cities \mbox{%DIFAUXCMD
\cite{pumain2018evolutionary}}\hspace{0pt}%DIFAUXCMD
. }\DIFdelend \DIFaddbegin \DIFadd{urban firm networks. }\DIFaddend We examine the interactions of European cities within firm linkages defined by corporate ownership links. Since transnational firms structure is one of the \DIFdelbegin \DIFdel{determinant }\DIFdelend \DIFaddbegin \DIFadd{determinants }\DIFaddend of the global economic space, it provides one accurate proxy to unveil geo-economic structures \DIFdelbegin \DIFdel{\mbox{%DIFAUXCMD
\cite{2019arXiv191014652Z}}\hspace{0pt}%DIFAUXCMD
. }%DIFDELCMD < 

%DIFDELCMD < %%%
\DIFdel{More precisely, our contribution consists in the following}\DIFdelend \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{2020Zdanowska}}\hspace{0pt}%DIFAUXCMD
. More precisely}\DIFaddend : (i) we \DIFdelbegin \DIFdel{propose an empirical analysis of the firm ownership urban network in the European Union, based on the Bureau Van Dijk's }%DIFDELCMD < \emph {%%%
\DIFdel{AMADEUS}%DIFDELCMD < } %%%
\DIFdel{database \mbox{%DIFAUXCMD
\cite{AMADEUS2018}}\hspace{0pt}%DIFAUXCMD
; (ii) we }\DIFdelend \DIFaddbegin \DIFadd{firstly }\DIFaddend introduce a generative network model to simulate the growth of such linkages at urban areas scale, \DIFdelbegin \DIFdel{which combines }\DIFdelend \DIFaddbegin \DIFadd{combining }\DIFaddend multiple factors influencing link formation, such as the economic intensity of the urban areas corresponding to the \DIFdelbegin \DIFdel{origin and destination }\DIFdelend \DIFaddbegin \DIFadd{source and target }\DIFaddend nodes, the industrial sector proximity, the strength of previous links, and the geographical and socio-cultural \DIFdelbegin \DIFdel{distance; (iii}\DIFdelend \DIFaddbegin \DIFadd{distances; (ii}\DIFaddend ) the model allows us to \DIFaddbegin \DIFadd{then }\DIFaddend compare the effect of \DIFaddbegin \DIFadd{the }\DIFaddend different factors on the final network structure, which is extensively studied through model sensitivity analysis and exploration; \DIFdelbegin \DIFdel{and }\DIFdelend \DIFaddbegin \DIFadd{(iii) we develop an empirical analysis of the firm ownership urban network in the European Union, based on the Bureau Van Dijk's }\emph {\DIFadd{AMADEUS}} \DIFadd{database \mbox{%DIFAUXCMD
\cite{AMADEUS2018}}\hspace{0pt}%DIFAUXCMD
;  }\DIFaddend (iv) we \DIFaddbegin \DIFadd{use this data to }\DIFaddend calibrate the model on the empirical network\DIFdelbegin \DIFdel{.
}%DIFDELCMD < 

%DIFDELCMD < %%%
\DIFdel{The rest of this paper is organized as follows: we firstly describe the generative model for urban networks and proceed to an empirical analysis of the network used as a case study. We then proceed to a sensitivity analysis and exploration }\DIFdelend \DIFaddbegin \DIFadd{; and (v) we explore an application }\DIFaddend of the model \DIFdelbegin \DIFdel{on synthetic data. The model is calibrated on real European firm ownership data. We finally discuss implications of our results and possible extensions}\DIFdelend \DIFaddbegin \DIFadd{to an economic shock scenario, with pandemic-like stylised facts}\DIFaddend . 



\section*{Materials and Methods}

\subsection*{Generative urban network model}

\subsubsection*{Rationale}

The model is expected to capture a single macroscopic urban scale, \DIFdelbegin \DIFdel{i.e. the level of the urban system where basic entities }\DIFdelend \DIFaddbegin \DIFadd{which corresponds to the level at which nodes }\DIFaddend are cities. \DIFdelbegin \DIFdel{Links are induced by underlying firms but these are not explicit. Cities are defined }\DIFdelend \DIFaddbegin \DIFadd{These are characterised }\DIFaddend by their economic size \DIFdelbegin \DIFdel{, but also by an }\DIFdelend \DIFaddbegin \DIFadd{and their }\DIFaddend industrial sector profile. \DIFdelbegin \DIFdel{As the authors of \mbox{%DIFAUXCMD
\cite{martinus2018global} }\hspace{0pt}%DIFAUXCMD
point out, a combination of several distances may play a role in establishing linkages. Geographical }\DIFdelend \DIFaddbegin \DIFadd{Links are then created considering these features and different distance, or proximity measures \mbox{%DIFAUXCMD
\cite{martinus2018global}}\hspace{0pt}%DIFAUXCMD
. Note that, geographical }\DIFaddend distance, industrial proximity and complementarity will typically be equally significant \cite{cottineau2020nested}. \DIFdelbegin \DIFdel{Therefore, we combine several processes }\DIFdelend \DIFaddbegin \DIFadd{We therefore combine several features }\DIFaddend driving network growth: (i) geographical proximity (in our case the crow-fly distance \DIFaddbegin \DIFadd{between cities}\DIFaddend , but it can be \DIFdelbegin \DIFdel{generalized }\DIFdelend \DIFaddbegin \DIFadd{generalised }\DIFaddend to any type of accessibility); (ii) geopolitical proximity, which captures the higher propensity to establish links within existing submarkets within the European common market (\DIFdelbegin \DIFdel{confirmed }\DIFdelend \DIFaddbegin \DIFadd{this is confirmed to be  }\DIFaddend relevant by the fixed effect regression described below); (iii) city economic size, which \DIFdelbegin \DIFdel{presents }\DIFdelend \DIFaddbegin \DIFadd{is known to give rise to }\DIFaddend agglomeration effects; (iv) industrial proximity in terms of firm sector composition; and (v) previous linkages\DIFdelbegin \DIFdel{(influence of already existing links }\DIFdelend \DIFaddbegin \DIFadd{, which capture the influence of existing linkages created }\DIFaddend in the past\DIFdelbegin \DIFdel{)}\DIFdelend . This last point is crucial to capture accumulated effects and include path-dependencies, justifying further the use of a simulation model instead of a more simple statistical model.

\DIFaddbegin \DIFadd{It is worth mentioning that our model is not aimed to be predictive, but rather designed as an explanatory model in order to disentangle the influence of diverse processes and drivers in the growth of the urban network, and to test different hypotheses \mbox{%DIFAUXCMD
\cite{conte2012manifesto,varenne2018models}}\hspace{0pt}%DIFAUXCMD
. The model can also be used as a decision-making model, where different scenarios for potential policy applications can be explored. 
}

\DIFadd{In this work, we do not consider the relationship between countries given their economic complexity, such as the framework developed by  \mbox{%DIFAUXCMD
\cite{hidalgo2007product}}\hspace{0pt}%DIFAUXCMD
, where the diversity of products produced plays an essential role in determining co-dependencies and resilience.
What we investigate instead, is the role of linkages given by geography and history, and hence, the sector structure of cities does not evolve within the model.
}


\DIFaddend \subsubsection*{Model description}

Let $1 \leq i \leq N$ cities be defined at time $t$ by their economic structure such that $E_i(t)$ is the total economic volume (GDP) for city $i$ and \DIFdelbegin \DIFdel{$S_{ik}(t)$ }\DIFdelend \DIFaddbegin \DIFadd{$\mathbf{S_i} = S_{ik}(t)$ }\DIFaddend is a matrix giving economic volume proportions within each economic sector $k$, assuming \DIFaddbegin \DIFadd{that }\DIFaddend there are $K$ economic sectors. \DIFdelbegin \DIFdel{Formally}\DIFdelend \DIFaddbegin \DIFadd{Given these characteristics}\DIFaddend , the model \DIFdelbegin \DIFdel{creates }\DIFdelend \DIFaddbegin \DIFadd{evolves firm }\DIFaddend links between cities\DIFdelbegin \DIFdel{which are characterized by their economic size $E_i$ (GDP) and economic structure $S_{ik}$ in terms of activity sectors (probability distribution of firms within $K$ sectors)}\DIFdelend . Starting with an existing \DIFdelbegin \DIFdel{network with no links}\DIFdelend \DIFaddbegin \DIFadd{initial network}\DIFaddend , the model iteratively adds links \DIFdelbegin \DIFdel{, following a probability given by a generalized }\DIFdelend \DIFaddbegin \DIFadd{or updates their weights to generate a final directed weighted network.
}

\DIFadd{At each time step, one directed link is randomly drawn. We define a generalised }\DIFaddend Cobb-Douglas \DIFaddbegin \DIFadd{utility }\DIFaddend function \cite{vilcu2011geometric} as 

\begin{equation}
\DIFdelbegin \DIFdel{p}\DIFdelend \DIFaddbegin \DIFadd{u}\DIFaddend _{ij} \DIFdelbegin \DIFdel{\propto }\DIFdelend \DIFaddbegin \DIFadd{= }\DIFaddend \left(\frac{E_{i}}{E}\right)^{\gamma_O} \cdot \left(\frac{E_{j}}{E}\right)^{\gamma_D} \cdot \left(\frac{w_{ij}}{W}\right)^{\gamma_W} \cdot s\left(\DIFdelbegin \DIFdel{S_{ik}}\DIFdelend \DIFaddbegin \DIFadd{\mathbf{S_{i}}}\DIFaddend ,\DIFdelbegin \DIFdel{S_{jk}}\DIFdelend \DIFaddbegin \DIFadd{\mathbf{S_{j}}}\DIFaddend \right)^{\gamma_S} \cdot \exp \left(- d_{ij} / d_0\right) \cdot \exp \left(- c_{ij} / c_0\right)
\end{equation}
where $E  =  \sum_k E_k$\DIFdelbegin \DIFdel{, $W  = \sum_{i,j} w_{ij}$ }\DIFdelend \DIFaddbegin \DIFadd{; $w_{ij}$ are the }\DIFaddend weights of previous links, \DIFdelbegin \DIFdel{$s(S_{ik},S_{jk})$ }\DIFdelend \DIFaddbegin \DIFadd{and $W  = \sum_{i,j} w_{ij}$; $s(\mathbf{S_{i}},\mathbf{S_{j}})$ }\DIFaddend is a similarity function between \DIFdelbegin \DIFdel{activity sectors $S_{ik}$ and $S_{jk}$ taken as a cosine similarity, }\DIFdelend \DIFaddbegin \DIFadd{the distributions of activity sectors, taken to be the cosine similarity; }\DIFaddend $d_{ij}$ is the Euclidian distance\DIFdelbegin \DIFdel{, }\DIFdelend \DIFaddbegin \DIFadd{; }\DIFaddend and $c_{ij}$ is a socio-cultural distance.
\DIFdelbegin \DIFdel{In the case of an already existing link between two areas, the weight of the latter }\DIFdelend \DIFaddbegin 

\DIFadd{This allows us to define the probability to select one link as $p_{ij} = u_{ij} / \sum_{k,l} u_{kl}$. The weight of this link }\DIFaddend is incremented by a unit volume $w_0$.
\DIFdelbegin \DIFdel{The model }\DIFdelend \DIFaddbegin 

\DIFadd{The simulation }\DIFaddend is stopped either when a final time \DIFaddbegin \DIFadd{$t_f$ }\DIFaddend is reached or when the \DIFdelbegin \DIFdel{cumulated }\DIFdelend \DIFaddbegin \DIFadd{cumulative }\DIFaddend volume of links reaches a target quantity. \DIFdelbegin \DIFdel{This }\DIFdelend \DIFaddbegin \DIFadd{Therefore, the duration of the time period simulated can be adjusted by changing either $t_f$ or the $w_0$ parameter, given a total volume. 
}



\DIFadd{This model }\DIFaddend formulation can be considered both as an economic utility model and \DIFaddbegin \DIFadd{as }\DIFaddend a generalisation of \DIFdelbegin \DIFdel{spatial interaction models. }%DIFDELCMD < 

%DIFDELCMD < %%%
\DIFdel{Note }\DIFdelend \DIFaddbegin \DIFadd{a spatial interaction model. We must furthermore precise }\DIFaddend that: (i) we consider an asymmetric influence of sizes, assuming that link directions are important (\DIFdelbegin \DIFdel{similarly }\DIFdelend \DIFaddbegin \DIFadd{equivalently }\DIFaddend the similarity function $s$ may be taken as asymmetric); (ii) the influence of previous links is similar to a preferential attachment process; (iii) we do not renormalise the exponents to 1 to ensure \DIFdelbegin \DIFdel{to include }\DIFdelend \DIFaddbegin \DIFadd{the inclusion of }\DIFaddend convex functions. The ``geopolitical/sociocultural'' distance remains abstract and should be parametrised (see setup below) and estimated in the data-driven setting. In this simple version of the model\DIFdelbegin \DIFdel{we assume an absence of evolution of economic size}\DIFdelend \DIFaddbegin \DIFadd{, we do not consider the evolution of either the economic size nor of the sectorial proximity}\DIFaddend , which means that the adjusted parameters are valid on a \DIFdelbegin \DIFdel{restricted }\DIFdelend \DIFaddbegin \DIFadd{limited }\DIFaddend time period.


\subsubsection*{Model setup}

When setting the model, it is important to consider that different initial conditions (or parametrisation on real data), given by the spatial distribution, the sizes and industrial sector compositions, are going to affect the behaviour of the model. One of the authors \cite{raimbault2019space} has already shown that the initial spatial configuration can have significant impacts on model outcomes. We therefore consider two versions: one with a synthetic system of cities which can be stochastically repeated, and one other based on real data.


\paragraph{Synthetic setup}

The synthetic system of cities is generated to be at the scale of a continent with properties similar to Europe: (i) $N=700$ cities with an empirical power-law from the Global Human Settlements database for economic sizes ($\alpha = 1.1$), distributed randomly into a uniform and isotropic square space of width \DIFdelbegin \DIFdel{$d_{max}=3000km$}\DIFdelend \DIFaddbegin \DIFadd{$d_{max}=3000$km}\DIFaddend ;
(ii) \DIFaddbegin \DIFadd{cities are }\DIFaddend clustered into $C = 20$ countries using a k-means algorithm (this remains consistent with non-correlated city sizes at the scale of the countries as our cities are randomly distributed in space \cite{simini2019testing});
(iii) \DIFdelbegin \DIFdel{with }\DIFdelend \DIFaddbegin \DIFadd{their }\DIFaddend synthetic distribution of sectors \DIFdelbegin \DIFdel{following }\DIFdelend \DIFaddbegin \DIFadd{follows a }\DIFaddend log-normal \DIFdelbegin \DIFdel{distributions }\DIFdelend \DIFaddbegin \DIFadd{distribution }\DIFaddend adjusted in a way that large cities have more high-value activities and are more diverse.

More precisely\DIFdelbegin \DIFdel{for this last point, assuming }\DIFdelend \DIFaddbegin \DIFadd{, assuming that }\DIFaddend sectors are distributed continuously along a one-dimensional axis, cities are assumed to have a sector distribution with a log-normal density function. The largest city is constrained to have a standard deviation and a mode of $1/2$ \DIFdelbegin \DIFdel{and the smallest }\DIFdelend \DIFaddbegin \DIFadd{while for the smallest city it will be }\DIFaddend $1/K$, with a linear interpolation between the two for other cities. Parameters of the log-normal law are obtained by solving the corresponding two equations system for each city, and each distribution is discretised and renormalised to be a vector of probabilities. See S2 Text for all details of this synthetic setup.

In \DIFaddbegin \DIFadd{the }\DIFaddend synthetic experiments, the network is generated from an initial complete network with dummy links of weight \DIFdelbegin \DIFdel{1 }\DIFdelend \DIFaddbegin \DIFadd{$1$ }\DIFaddend until reaching $t_f=1500$, \DIFaddbegin \DIFadd{and }\DIFaddend with a unit link volume of $w_0 = 1$.

     
\paragraph{Real setup}

The real setup is done using the empirical network of ownership links. Urban areas are distributed according to their positions in the actual geographical space, and economic size and sector composition attributes are used. The socio-economic distance is constructed using information from the statistical \DIFdelbegin \DIFdel{modeling}\DIFdelend \DIFaddbegin \DIFadd{modelling}\DIFaddend , by considering fixed-effect coefficients estimated for each pair of countries. See S2 Text for more details on the construction of the socio-economic distance matrix.

The initial network is the same than in the synthetic setup, and the real links are taken as targets for the generated network. We constrain the total volume of flows by setting $w_0 = \sum_{ij} w_{ij}^{(obs)} / t_{f}$ when the number of time steps $t_f$ is given as a parameter \DIFaddbegin \DIFadd{and $w_{ij}^{(obs)}$ are observed flows}\DIFaddend .

\subsection*{Model parameters and indicators}

The model parameters are the Cobb-Douglas weights $\gamma_O,\gamma_D,\gamma_W,\gamma_S$ and distance decay parameters $d_0,c_0$. As the model also includes path-dependencies by integrating the influence of previous links, it cannot be reduced to a simple statistical model. Finally, the role of space introduces even further complexity\DIFdelbegin \DIFdel{, yielding }\DIFdelend \DIFaddbegin \DIFadd{. These aspects yield }\DIFaddend a generative model, \DIFdelbegin \DIFdel{which has }\DIFdelend \DIFaddbegin \DIFadd{in the sense that the successive states have }\DIFaddend to be simulated \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{epstein1999agent}}\hspace{0pt}%DIFAUXCMD
}\DIFaddend .

We consider two main \DIFaddbegin \DIFadd{geographical phenomena and therefore two }\DIFaddend macroscopic indicators to quantify the generated network. Firstly, geographical structures are captured by internationalisation \DIFdelbegin \DIFdel{(}\DIFdelend \DIFaddbegin \DIFadd{of city-interactions in the context of intensification of globalisation and transnational city networking at the worldwide level \mbox{%DIFAUXCMD
\cite{taylor2001specification}}\hspace{0pt}%DIFAUXCMD
. Hence we define the internationalisation indicator as the }\DIFaddend modularity of countries in the network\DIFdelbegin \DIFdel{)}\DIFdelend . The situation of a minimised modularity corresponds to dense connections between cities of different countries in Europe and sparse connections between cities of the same European country. In practice, modularity is computed as follows
\begin{equation}
    I = \frac{1}{2 \left|E\right|} \cdot \sum_{i,j} \left(w_{ij} - \frac{d_i d_j}{2 \left|E\right|}\right) \mathbbm{1}_{c_i = c_j}
\end{equation}
where $d_i$ is the weighted degree of city $i$ in country $c_i$.

Secondly, we consider the \DIFdelbegin \DIFdel{metropolisation indicator }\DIFdelend \DIFaddbegin \DIFadd{geographical process of metropolisation. The later can be defined as a concentration of population and major economic decision functions in metropolises, in particular at the world-system level \mbox{%DIFAUXCMD
\cite{Sassen1991}}\hspace{0pt}%DIFAUXCMD
. Metropolises playing the role of gateways of globalisation, are competing between each other to attract the most skilled workers and innovative industries \mbox{%DIFAUXCMD
\cite{RozenblatPumain2007}}\hspace{0pt}%DIFAUXCMD
. Metropolisation gradients have been linked in the literature on systems of cities to several economic and political aspects \mbox{%DIFAUXCMD
\cite{RozenblatPumain2018} }\hspace{0pt}%DIFAUXCMD
\mbox{%DIFAUXCMD
\cite{PumainRozenblat2019} }\hspace{0pt}%DIFAUXCMD
\mbox{%DIFAUXCMD
\cite{Zdanowskaetal2020}}\hspace{0pt}%DIFAUXCMD
. We introduce in this paper a metropolisation indicator defined }\DIFaddend as the correlation between the weighted degree and the GDP of the city\DIFdelbegin \DIFdel{. With this indicator we }\DIFdelend \DIFaddbegin \DIFadd{, in order to }\DIFaddend capture the effect of large cities\DIFaddbegin \DIFadd{, }\DIFaddend or metropolises of regional importance\DIFaddbegin \DIFadd{, }\DIFaddend attracting the biggest amount of links and involved in \DIFdelbegin \DIFdel{high }\DIFdelend \DIFaddbegin \DIFadd{a high number of }\DIFaddend interactions with other cities.  \DIFdelbegin \DIFdel{It is computed with }\DIFdelend \DIFaddbegin \DIFadd{The later is computed using }\DIFaddend a Pearson correlation estimator \DIFdelbegin \DIFdel{as
}\DIFdelend \DIFaddbegin \DIFadd{on logarithms as follows:
}\DIFaddend \begin{equation}
    M = \hat{\rho} \left[\DIFaddbegin \DIFadd{\log (}\DIFaddend d_i\DIFaddbegin \DIFadd{) }\DIFaddend , \DIFaddbegin \DIFadd{\log (}\DIFaddend E_i\DIFaddbegin \DIFadd{) }\DIFaddend \right]
\end{equation}

In \DIFdelbegin \DIFdel{this work, we do not consider the relationship between countries given their economic complexity, such as the framework developed by  \mbox{%DIFAUXCMD
\cite{hidalgo2007product}}\hspace{0pt}%DIFAUXCMD
, where the diversity of products produced plays an essential role in determining co-dependencies and resilience. What we investigate instead, is the role of linkages given by geography and history, and hence, the sector structure of cities does not evolve within the model.
}\DIFdelend \DIFaddbegin \DIFadd{addition, we also consider an indicator giving insight of the structure of the network: this is the average size of communities obtained with a modularity optimisation algorithm (weighted Louvain algorithm \mbox{%DIFAUXCMD
\cite{blondel2008fast}}\hspace{0pt}%DIFAUXCMD
). This is complementary to internationalisation, as it captures the endogenous structure of the network and the average size of international business clusters.
}\DIFaddend 


\subsection*{Empirical data}
\DIFdelbegin %DIFDELCMD < 

%DIFDELCMD < %%%
\DIFdel{Companies from }%DIFDELCMD < \emph {%%%
\DIFdel{AMADEUS}%DIFDELCMD < } %%%
\DIFdelend \DIFaddbegin 

\DIFadd{We base our study on empirical data from the }\emph{\DIFadd{AMADEUS}} \DIFadd{dataset produced by the Bureau Van Dijk (BVD) on transnational firms in Europe. }\emph{\DIFadd{AMADEUS}} \DIFadd{provides a precise location, turnover and activity codes for owners and owned companies in all sectors in Europe. The Bureau Van Dick gathers, homogenises and completes the information on these firms from national sources, publications of consultancies and audit firms such as KPMG, Deloitte, PricewaterhouseCoopers (PwC), Ernst \& Young (EY), Mazars, and those of other financial organisations such as Moody's, Fitch, Standard \& Poor's, Thomson Reuters or Duns and Bradstreet. A representativity study shows that }\emph{\DIFadd{ORBIS}} \DIFadd{--the Bureau Van Dijk's dataset for firms at the worldwide scale--, captures around 10 percent of existing foreign direct investments in 2011 in Poland \mbox{%DIFAUXCMD
\cite{Zdanowska2018}}\hspace{0pt}%DIFAUXCMD
. \mbox{%DIFAUXCMD
\cite{bajgar2020coverage} }\hspace{0pt}%DIFAUXCMD
find that the coverage of the }\emph{\DIFadd{ORBIS}} \DIFadd{database on OECD countries is a representative sample, but with a better performance on larger firms. As we aggregate company turnovers on urban areas in our analysis, we thus do not expect much representativity bias in the inter-urban network.
}

\DIFadd{Companies from }\emph{\DIFadd{AMADEUS}} \DIFaddend are georeferenced using the Geonames database (using postcode or address depending on the information available). We then join this data with the Global Human Settlement dataset GHS-FUA for Functional Urban Areas \cite{Florczyk2019ghs} -- which delineate the commuting areas for urban centres. Starting from a firm-level dataset of 1,562,862 nodes and 1,866,936 links, we obtain a directed network of 573 urban areas and 9323 ownership links. The weight of links is obtained by computing the owned share of turnover at destination, i.e. $w_{ij} = \sum_{k \in i,l \in j} p_{kl} \cdot T_l$ where $p_{kl}$ is the ownership share of company $l$ by company $k$ and $T_l$ is the turnover of company $l$. Node attributes include the economic size of urban areas, that we compute as the sum of turnovers of companies within the area. This quantity is highly correlated with the GDP of the area-level included in the GHS database (Spearman correlation $\rho = 0.71$) and also with population ($\rho = 0.60$). \DIFdelbegin \DIFdel{We then expect to capture size effects while keeping the consistence of a single main data source. }\DIFdelend Another attribute of the nodes is the industrial sector composition, expressed as a proportion of turnover in the area associated to a given industrial sector. Detailed sectors of firms are available up to the four digits of the NACE classification in the raw data \cite{EUROSTAT2008}. We consider the first level classification (21 categories) and compute sector proportions accordingly. This allows us to define an industrial proximity matrix between urban areas, taking a cosine similarity between vectors as $s_{ij} = \sum_{k=1}^{K} S_{ik}\cdot S_{jk}$ where $S_{ik}$ are sector proportions.

The urban network \DIFaddbegin \DIFadd{is sparse with a density of around $0.028$. It }\DIFaddend has heavy tail weighted degree and edge weight distributions, as shown in Fig.~\ref{fig:nwdist}. We fit power law and log-normal distributions, including minimal value cutoff following \cite{clauset2009power}, using the \texttt{powerlaw} R package \cite{powerlawpackage}. For both, log-normal distributions appear to be a better fit ($\mu=18.8$, $\sigma=2.3$ for weighted degree; $\mu=13.8$, $\sigma=2.8$ for edge weight), and include a much broader range of empirical distributions with lower estimated cut-offs. These heavy tail properties suggest the relevance of a generative model including self-reinforcing processes, which are known to produce such distributions.

%%%%%%%%%%%%%
\begin{figure}
    %DIF < \begin{center}
    %DIF <     \includegraphics[width=\linewidth]{figures/Fig1.png}
    %DIF < \end{center}
    \DIFaddbeginFL \begin{center}
        %DIF > \includegraphics[width=\linewidth]{figures/Fig1.png}
    \end{center}
    \DIFaddendFL \vspace{2cm}
    \caption{Distributions of network properties. \textit{(Left)} \DIFdelbeginFL \DIFdelFL{Cumulated }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{Cumulative }\DIFaddendFL distribution for edge weight, with power law fit (red) and log-normal fit (green); \textit{(Right)} \DIFdelbeginFL \DIFdelFL{Cumulated }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{Cumulative }\DIFaddendFL distribution for weighted degree.}
    \label{fig:nwdist}
\end{figure}
%%%%%%%%%%%%%


\DIFdelbegin \DIFdel{When focusing }\DIFdelend \DIFaddbegin \DIFadd{To focus }\DIFaddend on the community structure of the network, \DIFaddbegin \DIFadd{we test }\DIFaddend different modularity maximisation algorithms \DIFdelbegin \DIFdel{(}\DIFdelend ran on the undirected corresponding network\DIFdelbegin \DIFdel{) result in the same }\DIFdelend \DIFaddbegin \DIFadd{. The Louvain algorithm \mbox{%DIFAUXCMD
\cite{blondel2008fast} }\hspace{0pt}%DIFAUXCMD
provides an }\DIFaddend undirected modularity of \DIFdelbegin \DIFdel{0.38, a directed modularity \mbox{%DIFAUXCMD
\cite{nicosia2009extending} }\hspace{0pt}%DIFAUXCMD
of 0.34 for the }\DIFdelend \DIFaddbegin \DIFadd{$0.388$, with 19 communities. The corresponding directed modularity computed following \mbox{%DIFAUXCMD
\cite{nicosia2009extending} }\hspace{0pt}%DIFAUXCMD
is $0.362$. The }\DIFaddend greedy algorithm of \cite{clauset2004finding} \DIFdelbegin \DIFdel{and of 0.36 for the Louvain algorithm \mbox{%DIFAUXCMD
\cite{blondel2008fast}}\hspace{0pt}%DIFAUXCMD
, corresponding to 36 communities (resp. 15)}\DIFdelend \DIFaddbegin \DIFadd{results in 35 communities for a undirected modularity of $0.376$ and an directed modularity of $0.352$}\DIFaddend . In comparison, when taking \DIFdelbegin \DIFdel{into account }\DIFdelend \DIFaddbegin \DIFadd{as communities }\DIFaddend 29 \DIFaddbegin \DIFadd{existing }\DIFaddend countries, the \DIFdelbegin \DIFdel{classification of urban areas by country has a modularity of 0.32}\DIFdelend \DIFaddbegin \DIFadd{corresponding directed modularity is $0.323$}\DIFaddend . This indicates that the structure of flows present certain regional patterns. Indeed, a null model assigning random labels with 30 communities, bootstrap 1000 times, yields an average modularity of \DIFdelbegin \DIFdel{$0.049 \pm 0.002$}\DIFdelend \DIFaddbegin \DIFadd{$0.050 \pm 0.0017$}\DIFaddend , confirming the statistical significance of these communities. We show in Fig.~\ref{fig:fig2} a map of the communities obtained.

The communities reflect characteristic socio-cultural structures and cross-border economic ties throughout Europe. Cities in France, Belgium and Luxembourg belong to the same cluster as they share French as a common business language, but also cross-border tax arrangements creating easier economic interactions \cite{DecovilleDurand2019}. The same socio-cultural proximity effect is seen in cities of the United Kingdom and Ireland, and those of Sweden, Finland, Estonia, Latvia and Lithuania. The cluster composed of Dutch and Polish cities is justified by the fact that firms from the Netherlands are among the first foreign owners of polish firms since 2010 \DIFdelbegin \DIFdel{\mbox{%DIFAUXCMD
\cite{2019arXiv191014652Z}}\hspace{0pt}%DIFAUXCMD
}\DIFdelend \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{2020Zdanowska}}\hspace{0pt}%DIFAUXCMD
}\DIFaddend . The cluster including cities in Germany, Czech Republic, Austria, Slovakia, Hungary and partly in Romania, find its origin in the dependence of the Central and Eastern European economies on German and Austrian large companies mostly from the automotive sector (i.e. Audi, Volkswagen). In addition, all cities of the later cluster have in common to be at the intersection of a very important freight transport route in Europe from Germany to Turkey \cite{Zdanowska2017}. 
\DIFaddbegin 


\DIFaddend %%%%%%%%%%%%%%
\begin{figure}
    %DIF < \begin{center}
    \DIFaddbeginFL \begin{center}
    \DIFaddendFL %\includegraphics[width=\linewidth]{figures/Fig2.png}
    %DIF < \end{center}
    \DIFdelbeginFL %DIFDELCMD < \vspace{2cm}
%DIFDELCMD <     %%%
\DIFdelendFL \DIFaddbeginFL \end{center}
    \DIFaddendFL \caption{{\bf Map of network communities obtained by modularity maximisation.} \DIFaddbeginFL \DIFaddFL{We show communities with the higher modularity, obtained with the Louvain algorithm. }\DIFaddendFL The area of circles gives the turnover within the Functional Urban Area, and \DIFdelbeginFL \DIFdelFL{color }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{colour }\DIFaddendFL the community it belongs to. Urban Areas in communities of size smaller than 3 were not \DIFdelbeginFL \DIFdelFL{colored }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{coloured }\DIFaddendFL for readability. \DIFaddbeginFL \DIFaddFL{Made with Natural Earth Data \mbox{%DIFAUXCMD
\cite{naturalearth}}\hspace{0pt}%DIFAUXCMD
.}\DIFaddendFL }
    \label{fig:fig2}
\end{figure}
%%%%%%%%%%%%%%

\DIFaddbegin \DIFadd{Macroscopic indicators of internationalisation and metropolisation can also be computed on the empirical network. Internationalisation corresponds to the modularity of countries in the network, which was computed above as $I = 0.32$. Metropolisation computed with turnover has a very high empirical value $M = 0.961$ (95 \% confidence interval $\left[ 0.954 ; 0.967\right]$). A variation of this indicator computed with GDP from the GHSL database still shows a relatively high correlation ($0.776 \left[ 0.736 ; 0.811\right]$). In practice, this European urban network is thus highly internationalised and metropolised, following what can be expected from the empirical literature on urban networks.
}


\DIFaddend \subsubsection*{Statistical analysis}

In order to understand the most determining geo-economic factors influencing the creation of links between cities, we run a statistical analysis as applied in the case of unconstrained spatial interaction models \cite{wilson1975some}. We test five different statistical models, which progressively include the processes for the generative network model. The most general statistical one is:

\begin{equation}
\log(w_{ij}) = \log(d_{ij}) + \log(T_i) + \log(T_j) + \log(s_{ij}) + \alpha_{c_i,c_j} + \varepsilon_{ij}
\end{equation}
where $\alpha_{c_i,c_j}$ is a fixed effect term for the coupling of countries $c_i,c_j$, and $T_i$, $T_j$ correspond to the turnovers of cities $i$ and $j$ respectively. 

This multiplicative form linearly transformed through logarithms is common practice for spatial interaction models. Note that no constraints are considered, since links include information about the turnover and a share of ownership at the same time. Estimation results are given in Table~\ref{tab:reg}. We also fit a Poisson \DIFdelbegin \DIFdel{generalized }\DIFdelend \DIFaddbegin \DIFadd{generalised }\DIFaddend linear model with a logarithmic link on the rounded weights \cite{flowerdew1988fitting}. The findings show that when \DIFdelbegin \DIFdel{distance only }\DIFdelend \DIFaddbegin \DIFadd{only distance }\DIFaddend is taken into account (model 1), it has a significant negative effect on link creation, but with an explained variance close to zero. Model 2 adds fixed effects by pair of countries, for which around a third are significant, and with a better $R^2$ of 0.17. Adding the economic size at origin and destination (turnovers $T_i$ and $T$, model 3) slightly improves the explanatory power (model 3). The best model \DIFaddbegin \DIFadd{in terms of explained variance ($R^2 = 0.31$) }\DIFaddend among the linear ones is the model 4, \DIFdelbegin \DIFdel{with }\DIFdelend \DIFaddbegin \DIFadd{which includes }\DIFaddend all factors and fixed effects\DIFdelbegin \DIFdel{, both in terms of explained variance ($R^2 = 0.31$) and Akaike information criterion. Model 4 also indicates the absence of }\DIFdelend \DIFaddbegin \DIFadd{. This model also have the lowest Akaike Information Criterion (AIC) among the comparable linear models, meaning that the fit improvement is not due to }\DIFaddend overfitting. Model 5, which is a Poisson model with all variables is much a better fit regarding pseudo-$R^2$ and provides \DIFdelbegin \DIFdel{much }\DIFdelend more significant estimates (all fixed effects significant and \DIFdelbegin \DIFdel{much }\DIFdelend smaller standard deviations).
\DIFaddbegin 

\DIFadd{To investigate the role of missing links in these results (these have been removed since previous models are fitted on logarithms), we fit extended statistical models for count data focused on the role of zeros. Two different flavors of such models are: the hurdle model \mbox{%DIFAUXCMD
\cite{mullahy1986specification}}\hspace{0pt}%DIFAUXCMD
, which corresponds to a conditional count model; and a zero-inflated Poisson model \mbox{%DIFAUXCMD
\cite{lambert1992zero}}\hspace{0pt}%DIFAUXCMD
, which mixes a count model with an additional component to generate zeros. Full estimation results using \mbox{%DIFAUXCMD
\cite{zeileis2008regression}}\hspace{0pt}%DIFAUXCMD
, are shown in S2 Text. As the network is rather sparse, these more detailed statistical models do not perform better than more simple models, as missing links are difficult to predict. The best zero-inflated model has a $R^2 = 0.16$, and it is similar to the performance of the best hurdle model $R^2 = 0.17$.
}


\DIFaddend Across all models, consistent qualitative \DIFdelbegin \DIFdel{stylized }\DIFdelend \DIFaddbegin \DIFadd{stylised }\DIFaddend facts regarding link creation between cities are revealed: (i) distance has a negative influence; (ii) economic sizes have a positive effect, with the size of the origin city being more important (\DIFdelbegin \DIFdel{consistent in }\DIFdelend \DIFaddbegin \DIFadd{this is consistent within }\DIFaddend the ownership links context, as \DIFaddbegin \DIFadd{these are }\DIFaddend strongly driven by \DIFdelbegin \DIFdel{decision }\DIFdelend \DIFaddbegin \DIFadd{decisions }\DIFaddend at the headquarter/owner level); (iii) industrial proximity has a positive influence, i.e. similarity is more important than complementarity for this dimension; (iv) a large part of country fixed-effects are statistically significant; and (v) the order of magnitude of the influence of each factor is roughly the same, which means that no process totally dominates the others.
\DIFdelbegin \DIFdel{This }\DIFdelend \DIFaddbegin 

\DIFadd{This preliminary analysis }\DIFaddend confirms the relevance of including all these different dimensions in the generative network model, since they have a comparable explanatory role in statistical models.


%%%%%%%%%%%%%
\begin{table}[!ht]
\begin{adjustwidth}{-1in}{0in}
\caption{{\bf Statistical models.} Ordinary Least Square estimations of statistical models explaining $\log(w_{ij})$ (standard errors in parenthesis). ***, ** and * respectively indicate 0.01, 0.05 and 0.1 levels of significance. For the fixed effect by origin-destination pairs of countries, the proportion of significant coefficients is attributed (where $p<0.1$). Models (1) to (4) are ordinary least square models, while model (5) is a Poisson \DIFdelbeginFL \DIFdelFL{generalized }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{generalised }\DIFaddendFL linear model with logarithmic link. We compare model performance using $R^2$, Mean Square Error, and Akaike Information Criterion. For the Poisson model (model 5), AIC is not given as it is not comparable. \label{tab:reg}}
\medskip
\begin{tabular}{|l|c|c|c|c|c|}
\hline
Model  & (1) & (2) & (3) & (4) & (5) \\ 
\hline
$\log(d_{ij})$ &      -0.06** (0.03) &   -0.11** (0.05)  & -0.41*** (0.02)  & -0.35*** (0.04)  &  -0.26*** ($5\cdot 10^{-6}$) \\
$\log(T_i)$ &   &   & 0.56*** (0.01) &  0.56*** (0.01) & 0.79*** ($2\cdot 10^{-6}$) \\
$\log(T_j)$ &     &   & 0.39*** (0.01) &  0.39*** (0.01) & 0.66***  ($1.5\cdot 10^{-6}$) \\
$\log(s_{ij})$ &     &   &  &  0.19*** (0.07) & 0.53*** ($9\cdot 10^{-6}$)  \\
Countries &    &  28.3\% &   &  26.5\% & 100\% \\
\hline
$R^2$ &       0.00059   &  0.17 & 0.21 &  0.31  &  0.56 \\
MSE & 7.75 & 6.84 & 6.10 & 5.33 & 8.72 \\
AIC &        44304   &  43578  &  42131  & 41917 &   \\
\hline
\end{tabular}
\end{adjustwidth}
\end{table}
%%%%%%%%%%%%%





\section*{Model exploration and calibration}

The model is implemented in NetLogo, which provides a good compromise between performance and interactive prototyping and exploration \cite{railsback2017improving}. Numerical experiments are done by integrating the model into the OpenMOLE software for model exploration \DIFdelbegin \DIFdel{\mbox{%DIFAUXCMD
\cite{reuillon2013openmole}}\hspace{0pt}%DIFAUXCMD
, which provides }\DIFdelend \DIFaddbegin \DIFadd{and validation \mbox{%DIFAUXCMD
\cite{reuillon2013openmole}}\hspace{0pt}%DIFAUXCMD
. This platform implements }\DIFaddend sensitivity analysis and calibration methods and \DIFaddbegin \DIFadd{offers }\DIFaddend a transparent access to high-performance computing infrastructures\DIFaddbegin \DIFadd{, from local servers to clusters and computing grids}\DIFaddend . The model source code, the aggregated network data (the raw initial firm network cannot be made available for data ownership reasons), and the results are available on the open Git repository of the project at \url{https://github.com/JusteRaimbault/ABMCitiesFirms}. Large simulation result files are available on the dataverse repository at \url{https://doi.org/10.7910/DVN/UPX23S}. We show in Fig.~\ref{fig:fig3} examples of generated networks, with very contrasted patterns obtained with different spatial interaction ranges. Low values of the gravity decay parameter yield local networks around main cities, while long interaction ranges yield more integrated networks. \DIFdelbegin \DIFdel{We also show networks simulated in the real setting}\DIFdelend \DIFaddbegin \DIFadd{The same results can be observed for the networks generated using the real data in the lower panels}\DIFaddend .


%%%%%%%%%%%%%
\begin{figure}
    %DIF < \begin{center}
    %DIF <     \includegraphics[width=\linewidth]{figures/Fig3.png}
    %DIF < \end{center}
    \DIFdelbeginFL %DIFDELCMD < \vspace{2cm}
%DIFDELCMD <     %%%
\DIFdelendFL \DIFaddbeginFL \begin{center}
        %DIF > \includegraphics[width=\linewidth]{figures/Fig3.png}
    \end{center}
    \DIFaddendFL \caption{Example of simulated networks at $t=1500$, for a synthetic system of cities (Top row) and the European urban network (Bottom row), with a high (resp. low) gravity decay parameter for the left column (resp. right).\label{fig:fig3}}
\end{figure}
%%%%%%%%%%%%%


\subsection*{Synthetic city systems}

We first study extensively the \DIFdelbegin \DIFdel{behavior }\DIFdelend \DIFaddbegin \DIFadd{behaviour }\DIFaddend of the model on synthetic systems of cities, to isolate its intrinsic \DIFdelbegin \DIFdel{behavior }\DIFdelend \DIFaddbegin \DIFadd{behaviour }\DIFaddend independently of a contingent geographical situation.

\paragraph{Sensitivity analysis}

A global sensitivity analysis first unveils an aggregated influence of parameters on model indicators. We apply Saltelli's Global Sensitivity method introduced by \cite{saltelli2008global}. This produces values for each parameter and each output of a first order sensitivity index, defined as $Var\left[\mathbb{E}_{\mathbf{X}_{\sim i}}\left(Y_j | X_i\right)\right] / Var\left[Y_j\right]$, for parameter $X_i$ and output $Y_j$, $\mathbf{X}_{\sim i}$ being all other parameters. This captures the total influence of $X_i$ all other things being equal. The total order index is given by $\mathbb{E}_{\mathbf{X}_{\sim i}} \left[Var(Y_j | \mathbf{X}_{\sim i})\right] / Var\left[Y_j\right]$ and captures non-homogeneity in \DIFdelbegin \DIFdel{behavior }\DIFdelend \DIFaddbegin \DIFadd{behaviour }\DIFaddend and interaction between parameters. Indices were estimated with a Sobol sequence sampling of 20,000 \DIFdelbegin \DIFdel{model runs }\DIFdelend \DIFaddbegin \DIFadd{parameter points (corresponding to 160,000 model runs) }\DIFaddend \cite{saltelli2010variance}. We give in S2 Text the full estimated results for sensitivity indices. To \DIFdelbegin \DIFdel{summarize}\DIFdelend \DIFaddbegin \DIFadd{summarise}\DIFaddend , we find that indicators related to modularity (internationalisation and optimal modularity) are mostly influenced by geographical parameters. On the contrary, indicators of network structure are driven by origin and destination sizes. The influence of sectors and historical links has a secondary but not negligible role. Altogether, the analysis \DIFdelbegin \DIFdel{witnesses of }\DIFdelend \DIFaddbegin \DIFadd{shows }\DIFaddend strong interaction effects between parameters, since for several indicators the total order index is one order of magnitude larger than the first order index. This means that the generative model captures some \DIFdelbegin \DIFdel{complex behavior }\DIFdelend \DIFaddbegin \DIFadd{aspects of the complex behaviour }\DIFaddend of the system.



\paragraph{One factor sampling}

A first numerical experiment of one-factor sampling on all Cobb-Douglas parameters and 100 stochastic repetitions confirms a good statistical convergence (\DIFaddbegin \DIFadd{the }\DIFaddend average Sharpe ratios for \DIFdelbegin \DIFdel{indicators }\DIFdelend \DIFaddbegin \DIFadd{the indicators are }\DIFaddend all larger than 5). We \DIFdelbegin \DIFdel{use thus }\DIFdelend \DIFaddbegin \DIFadd{thus use }\DIFaddend 20 repetitions in \DIFaddbegin \DIFadd{the }\DIFaddend following larger experiments (in the case of a normal distribution, a 95\% confidence interval on the average is of size $2\sigma \cdot 1.96 / \sqrt{n}$, what gives $n=16$ repetitions for a CI of width of the standard deviation). \DIFdelbegin \DIFdel{Behavior }\DIFdelend \DIFaddbegin \DIFadd{The behaviour }\DIFaddend of some indicators are shown in Fig.~\ref{fig:fig4}. For example, internationalisation and metropolisation both show a transition as a function of \DIFdelbegin \DIFdel{d$_o$}\DIFdelend \DIFaddbegin \DIFadd{$d_0$}\DIFaddend , from a local to a global regime. The sector proximity parameter $\gamma_S$ \DIFdelbegin \DIFdel{influences the internationalization linearly , but }\DIFdelend \DIFaddbegin \DIFadd{has a linearly increasing influence on internationalisation. On the contrary, it }\DIFaddend induces a maximum for \DIFdelbegin \DIFdel{the correlation between size and degree, which }\DIFdelend \DIFaddbegin \DIFadd{metropolisation, what }\DIFaddend can be interpreted as \DIFdelbegin \DIFdel{a setting where size and the total volume in a city are the most correlated}\DIFdelend \DIFaddbegin \DIFadd{the fact that too few or too much specialisation leading to less integrated cities in terms of metropolisation}\DIFaddend .


%%%%%%%%%%%%%
\begin{figure}
	%DIF < \begin{center}
	%DIF <     \includegraphics[width=\linewidth]{figures/Fig4.png}
	%DIF < \end{center}
	\DIFdelbeginFL %DIFDELCMD < \vspace{2cm}
%DIFDELCMD <     %%%
\DIFdelendFL \DIFaddbeginFL \begin{center}
	    %DIF > \includegraphics[width=\linewidth]{figures/Fig4.png}
	\end{center}
    \DIFaddendFL \caption{(Top Left) Internationalisation index decreases exponentially with gravity decay; (Top Right) Correlation between city weighted degree and size. Both plots show a transition from a local to a global regime. (Bottom Left) Internationalisation varies linearly with sector proximity $\gamma_S$; (Bottom Right) \DIFdelbeginFL \DIFdelFL{Correlation between degree and size }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{Metropolisation }\DIFaddendFL exhibits a maximum \DIFaddbeginFL \DIFaddFL{at $\gamma_S \simeq 1.2$}\DIFaddendFL , \DIFdelbeginFL \DIFdelFL{witnessing }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{suggesting }\DIFaddendFL an intermediate regime where \DIFdelbeginFL \DIFdelFL{size is the most important}\DIFdelendFL \DIFaddbeginFL \DIFaddFL{specialisation has more influence}\DIFaddendFL . \label{fig:fig4}}
\end{figure}
%%%%%%%%%%%%%



\paragraph{Grid exploration}

The model behaviour is then studied with a grid sampling for parameters and 20 repetitions (the computations are run on the European Grid Infrastructure, and are equivalent to 2.5 years of CPU time). \DIFdelbegin \DIFdel{Distance }\DIFdelend \DIFaddbegin \DIFadd{The distance }\DIFaddend decay and sector parameters are varied with 10 steps, other parameters with three. The influence of \DIFaddbegin \DIFadd{the }\DIFaddend gravity decay parameters is confirmed when plotting the \DIFdelbegin \DIFdel{internationalization }\DIFdelend \DIFaddbegin \DIFadd{internationalisation }\DIFaddend index against the distance, which exhibits an exponential decay as shown in Fig.~\ref{fig:fig5}. \DIFdelbegin \DIFdel{It interacts with the role of sectors and }\DIFdelend \DIFaddbegin \DIFadd{We show that }\DIFaddend the size of the origin \DIFdelbegin \DIFdel{, with a more significant effectof sector proximity, when size has the largest }\DIFdelend \DIFaddbegin \DIFadd{and the sector proximity also have a significant effect, although the latter only becomes relevant when the size of the origin has a strong }\DIFaddend influence (third panel).


%%%%%%%%%%%%%%
\begin{figure}
    %\includegraphics[width=\linewidth]{figures/Fig5.png}
    \DIFdelbeginFL %DIFDELCMD < \vspace{2cm}
%DIFDELCMD <     %%%
\DIFdelendFL \caption{The transition as a function of \DIFaddbeginFL \DIFaddFL{the }\DIFaddendFL interaction range depends on the influence of \DIFaddbeginFL \DIFaddFL{the }\DIFaddendFL origin size $\gamma_O$; \DIFaddbeginFL \DIFaddFL{the }\DIFaddendFL sector proximity $\gamma_S$ plays a role only for a large influence of the origin.\label{fig:fig5}}
\end{figure}
%%%%%%%%%%%%%%

Other indicators exhibit non-trivial patterns. For example, when considering \DIFaddbegin \DIFadd{the }\DIFaddend average community size of the final network as shown in Fig.~\ref{fig:fig6}, we obtain a maximal integration in terms of \DIFaddbegin \DIFadd{the }\DIFaddend communities at an intermediate value of the gravity decay \DIFaddbegin \DIFadd{parameter}\DIFaddend . This can be interpreted as the emergence of a regional regime. The size of \DIFaddbegin \DIFadd{the }\DIFaddend communities is largely influenced by the value of the elasticities for the similarity function and the ratio of the economic output of the area. In particular, we observe a qualitative inversion of the role of $\gamma_S$ when introducing an effect of the origin (switching $\gamma_O$ from 0 to 1, first panel to second panel). The maximal community size disappears when $\gamma_O = 2$, implying a regime with small local communities where large cities mostly connect with their hinterland. These experiments \DIFdelbegin \DIFdel{reveal a }\DIFdelend \DIFaddbegin \DIFadd{show the diverse stylised facts that the model is capable of producing, while at the same time they reveal the }\DIFaddend complex interplay between \DIFdelbegin \DIFdel{processes and how the model produces diverse stylised facts}\DIFdelend \DIFaddbegin \DIFadd{the different processes involved}\DIFaddend .

%%%%%%%%%%%%%%
\begin{figure}
    %\includegraphics[width=\textwidth]{figures/Fig6.png}
	\DIFdelbeginFL %DIFDELCMD < \vspace{2cm}
%DIFDELCMD < 	%%%
\DIFdelendFL \caption{Maximal integration in terms of \DIFaddbeginFL \DIFaddFL{the }\DIFaddendFL community size is achieved at an intermediate value of d$_o$: emergence of a regional regime; \DIFaddbeginFL \DIFaddFL{the }\DIFaddendFL maximal size depends on the role of \DIFaddbeginFL \DIFaddFL{the }\DIFaddendFL sectors $\gamma_S$ in a decreasing way when the origin size is deactivated, and in an increasing way when $\gamma_o=1$; this regime disappears when the influence of the origin size becomes too large.\label{fig:fig6}}
\end{figure}
%%%%%%%%%%%%%%


\paragraph{Impact of urban hierarchy}

We run a specific experiment to study the impact of \DIFaddbegin \DIFadd{the }\DIFaddend urban hierarchy on firms dynamics. Rank-size law in cities is a central \DIFdelbegin \DIFdel{stylized }\DIFdelend \DIFaddbegin \DIFadd{stylised }\DIFaddend fact within urban theories, despite the discussions regarding the estimation of the power-law exponent, its actual values and its variation depending on the definition of cities considered \cite{cottineau2017metazipf,corral2020truncated}. \DIFdelbegin \DIFdel{In }\DIFdelend \DIFaddbegin \DIFadd{I }\DIFaddend this particular context, understanding how this parameter can impact urban dynamics within artificial systems of cities -- in which it can be modified to extreme values non observable in real systems--, should \DIFdelbegin \DIFdel{bring evidence on underlying processes }\DIFdelend \DIFaddbegin \DIFadd{help disentangling the variability due to model parameters from the variability due to the specific configuration of the urban system }\DIFaddend \cite{raimbault2019space}. We change the initial \DIFdelbegin \DIFdel{hierarchy }\DIFdelend \DIFaddbegin \DIFadd{hierarchical exponent }\DIFaddend $\alpha$ from \DIFdelbegin \DIFdel{0.5 }\DIFdelend \DIFaddbegin \DIFadd{0.1 }\DIFaddend to 2.0 with a step of 0.1, and also vary the interaction range $d_0$. The \DIFdelbegin \DIFdel{behavior of }\DIFdelend \DIFaddbegin \DIFadd{behaviour of the }\DIFaddend internationalisation and metropolisation indicators are shown in Fig.~\ref{fig:fig7}. As expected, the hierarchy of the urban system has an important impact on model outcomes. We find that more hierarchical urban systems tend to produce more international networks (\DIFdelbegin \DIFdel{internationalisation indicator is a modularitywhich is minimized when }\DIFdelend \DIFaddbegin \DIFadd{recall that the internationalisation indicator corresponds to the modularity, the latter is minimised when the }\DIFaddend networks span more \DIFdelbegin \DIFdel{accross }\DIFdelend \DIFaddbegin \DIFadd{across }\DIFaddend different countries)\DIFdelbegin \DIFdel{, what }\DIFdelend \DIFaddbegin \DIFadd{. This }\DIFaddend is consistent with the existence of \DIFdelbegin \DIFdel{globalized metropolis \mbox{%DIFAUXCMD
\cite{sassen1991global}}\hspace{0pt}%DIFAUXCMD
}\DIFdelend \DIFaddbegin \DIFadd{globalised metropolis \mbox{%DIFAUXCMD
\cite{Sassen1991}}\hspace{0pt}%DIFAUXCMD
}\DIFaddend . This effect is mitigated by \DIFdelbegin \DIFdel{lower }\DIFdelend \DIFaddbegin \DIFadd{reducing the }\DIFaddend interaction ranges. Regarding metropolisation, we observe \DIFdelbegin \DIFdel{a maximum values }\DIFdelend \DIFaddbegin \DIFadd{the existence of maxima }\DIFaddend as a function of \DIFdelbegin \DIFdel{initial hierarchy consistent }\DIFdelend \DIFaddbegin \DIFadd{the initial hierarchy }\DIFaddend across different interaction ranges $d_0$. This means that a too high hierarchy is detrimental to the global metropolisation when considering all cities, what may be due to the fact that in such a case very large cities are capturing all flows, leaving nothing to intermediate and medium-sized cities. Interestingly, the optimal value \DIFdelbegin \DIFdel{$\alpha \simeq 1.3$ }\DIFdelend \DIFaddbegin \DIFadd{$\alpha \simeq 1.1$ }\DIFaddend is not far from \DIFaddbegin \DIFadd{the }\DIFaddend observed values (which usually range between 0.9 and 1.1 but can take larger values such as 1.5 when extending the urban system \cite{Raimbault_2020}), \DIFdelbegin \DIFdel{what may imply }\DIFdelend \DIFaddbegin \DIFadd{implying }\DIFaddend that this optimality property is endogenous to the emergence of urban systems and linked to their intrinsic hierarchy.



%%%%%%%%%%%%%
\begin{figure}
    %DIF < \begin{center}
    %DIF <     \includegraphics[width=\linewidth]{figures/Fig7.png}
    %DIF < \end{center}
    \DIFdelbeginFL %DIFDELCMD < \vspace{2cm}
%DIFDELCMD <     %%%
\DIFdelendFL \DIFaddbeginFL \begin{center}
        %DIF > \includegraphics[width=\linewidth]{figures/Fig7.png}
    \end{center}
    \DIFaddendFL \caption{\DIFdelbeginFL \textbf{\DIFdelFL{Impact of urban hierarchy.}} %DIFAUXCMD
\DIFdelendFL \DIFaddbeginFL \textbf{\DIFaddFL{Impact of the urban hierarchy.}} \DIFaddendFL (Left) Internationalisation as a function of the initial synthetic \DIFdelbeginFL \DIFdelFL{hierarchy }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{hierarchical exponent }\DIFaddendFL $\alpha$, for different values of \DIFaddbeginFL \DIFaddFL{the }\DIFaddendFL interaction range $d_0$ (\DIFdelbeginFL \DIFdelFL{color}\DIFdelendFL \DIFaddbeginFL \DIFaddFL{colour}\DIFaddendFL ); (Right) Metropolisation as a function of $\alpha$, for different values of \DIFaddbeginFL \DIFaddFL{the }\DIFaddendFL interaction range $d_0$ (\DIFdelbeginFL \DIFdelFL{color}\DIFdelendFL \DIFaddbeginFL \DIFaddFL{colour}\DIFaddendFL ).\label{fig:fig7}}
\end{figure}
%%%%%%%%%%%%%



\subsection*{Model calibration on the European urban network}

We then apply the model to a real system of cities by calibrating it on the European ownership network. \DIFdelbegin \DIFdel{Model }\DIFdelend \DIFaddbegin \DIFadd{The model }\DIFaddend setup is done following the real setup described above. The number of time steps $t_f$ is left as an additional parameter, which in a sense determines the granularity of the cumulative network generation process. \DIFdelbegin \DIFdel{The }\DIFdelend \DIFaddbegin \DIFadd{To avoid overfitting and including information from statistical models, we deactivate the socio-economic gravity interactions by setting $c_0 = 0$ (distances are obtained as fixed effects from a statistical model). Finally, $w_0$ can be set so that a given constraint is satisfied in a way similar to spatial interaction models \mbox{%DIFAUXCMD
\cite{wilson1975some}}\hspace{0pt}%DIFAUXCMD
: in this case, we take an optimal value for the $\varepsilon_L$ objective given below as detailed in S2 Text.
}

\DIFadd{The model is fitted at the microscopic level on the link structure: the }\DIFaddend objective functions for calibration are the average mean squared error on logarithms of weights given by
\DIFdelbegin \DIFdel{$\varepsilon_L = \frac{1}{N^2} \sum_{i,j} \left(\log w_{ij} - \log \hat{w}_{ij} \right)^2$ if }\DIFdelend \DIFaddbegin 

\begin{equation}
\DIFadd{\varepsilon_L = \frac{1}{N^2} \sum_{i,j} \left(\log w_{ij} - \log \hat{w}_{ij} \right)^2
}\end{equation}
\DIFadd{where }\DIFaddend $\hat{w}_{ij}$ are the simulated weights, and the logarithm of the mean squared error \DIFdelbegin \DIFdel{$\varepsilon_M = \log\left(\frac{1}{N^2} \sum_{i,j} \left(w_{ij} - \hat{w}_{ij}\right)^2 \right)$. \mbox{%DIFAUXCMD
\cite{raimbault2018indirect} }\hspace{0pt}%DIFAUXCMD
showed that these two are complementary to calibrate urban systems models. 
}\DIFdelend \DIFaddbegin \DIFadd{(MSE)
}

\begin{equation}
\DIFadd{\varepsilon_M = \log\left(\frac{1}{N^2} \sum_{i,j} \left(w_{ij} - \hat{w}_{ij}\right)^2 \right)
}\end{equation}

\DIFadd{These two indicators capture the overall model performance with the logarithm of MSE, but also performance on medium-sized and small links, and are therefore complementary as shown in the case of cities population dynamics by \mbox{%DIFAUXCMD
\cite{raimbault2018indirect}}\hspace{0pt}%DIFAUXCMD
. A calibration on macroscopic indicators of metropolisation and internationalisation would not bring much knowledge on model processes, since several points from the grid experiment above - not designed for this - already provide a good performance: 19 parameter points out of 6534 are simultaneously below a relative error of 10\% on internationalisation and below 10\% on metropolisation. These points correspond to diverse parametrisation, suggesting the presence of equifinality when trying to calibrate at the macroscopic level. 
}

\DIFaddend Calibration is done using a genetic NSGA2 algorithm \cite{deb2002fast}, which is particularly suited for such a bi-objective calibration of a simulation model. Stochasticity is taken into account by adding the estimation confidence as an additional objective, and we filter the final population to have at least 20 samples. We use a population of 200 individuals and run the algorithm for 50,000 generations, on 1000 islands in parallel.


%%%%%%%%%%%%%%
\begin{figure}
	%DIF < \begin{center}
    \DIFaddbeginFL \begin{center}
    \DIFaddendFL %\includegraphics[width=0.75\linewidth]{figures/Fig8.png}
    %DIF < \end{center}
    \DIFdelbeginFL %DIFDELCMD < \vspace{2cm}
%DIFDELCMD < 	%%%
\DIFdelendFL \DIFaddbeginFL \end{center}
	\DIFaddendFL \caption{\textbf{Model calibration results.} Pareto front obtained for the bi-objective model calibration for $\varepsilon_L$ and $\varepsilon_M$ objectives. $\varepsilon_L$ can be compared to the MSE of statistical models fitted above, and the generative model outperform these for several \DIFdelbeginFL \DIFdelFL{parametrizations }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{parametrisations }\DIFaddendFL (lowest MSE 5.33 for statistical models). Point size gives the number of stochastic samples and \DIFdelbeginFL \DIFdelFL{color }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{colour }\DIFaddendFL the value of $\gamma_O$.\label{fig:fig8}}
\end{figure}
%%%%%%%%%%%%%%


We show in Fig.~\ref{fig:fig8} the calibration result, as a Pareto front of compromise points between the two objectives. As the mean squared error on logarithm is the same than the one for statistical models, it can be directly compared. The other objective would correspond to statistical models directly on variables: therefore, our model covers in a sense a set of intermediate models which make a compromise between the two objectives, and is therefore much more flexible. The values for $\varepsilon_L$ are for a large proportion of points lower than for statistical models, our model outperforms these in this predictive sense. As shown in Fig.~\ref{fig:fig8}, increasing values for $\gamma_O$ lead to better performance regarding $\varepsilon_L$: increasing the importance of the origin will provide a better fit on all \DIFdelbegin \DIFdel{order of magnitudes of }\DIFdelend \DIFaddbegin \DIFadd{orders of magnitude of the }\DIFaddend link weights (while $\varepsilon_M$ \DIFdelbegin \DIFdel{favors }\DIFdelend \DIFaddbegin \DIFadd{favours }\DIFaddend mostly the largest links given the fat-tail distribution).

When considering optimal points with $\varepsilon_L < 5.0$, the adjusted parameters are: long range gravity interactions \DIFdelbegin \DIFdel{and socio-economic interactions given by $d_0 = 5972 \pm 2148$ and $c_0 = 113 \pm 33$ (the maximal $c_{ij}$ is 11.8)}\DIFdelend \DIFaddbegin \DIFadd{given by $d_0 = 7432 \pm 2350$}\DIFaddend ; a stronger influence of \DIFdelbegin \DIFdel{destination than origin as $\gamma_O = 1.46 \pm 0.10$ and $\gamma_D = 2.0 \pm 0.05$}\DIFdelend \DIFaddbegin \DIFadd{the destination than of the origin as $\gamma_O = 1.41 \pm 0.11$ and $\gamma_D = 1.95 \pm 0.06$}\DIFaddend ; a comparable influence of sectors as \DIFdelbegin \DIFdel{$\gamma_S = 1.76 \pm 0.21$}\DIFdelend \DIFaddbegin \DIFadd{$\gamma_S = 1.20 \pm 0.14$}\DIFaddend ; a fine time granularity as \DIFdelbegin \DIFdel{$t_f = 4951 \pm 124$}\DIFdelend \DIFaddbegin \DIFadd{$t_f = 4927 \pm 119$}\DIFaddend ; and a very strong influence of previous links as \DIFdelbegin \DIFdel{$\gamma_W = 6.43 \pm 4.11$}\DIFdelend \DIFaddbegin \DIFadd{$\gamma_W = 7.72 \pm 5.15$}\DIFaddend . This last point furthermore shows in particular \DIFdelbegin \DIFdel{a role of the }\DIFdelend \DIFaddbegin \DIFadd{the importance of including }\DIFaddend path-dependency \DIFdelbegin \DIFdel{parameter, confirming the relevance of }\DIFdelend \DIFaddbegin \DIFadd{in }\DIFaddend this complex generative model\DIFdelbegin \DIFdel{including path-dependency}\DIFdelend . The interaction of this process with others implies an inversion of the relative importance of origin and destination (\DIFdelbegin \DIFdel{on the contrary to }\DIFdelend \DIFaddbegin \DIFadd{in opposition to the }\DIFaddend statistical models). The fact that calibrated interaction \DIFdelbegin \DIFdel{distances are }\DIFdelend \DIFaddbegin \DIFadd{distance is }\DIFaddend large is consistent with long range economic interactions within Europe. Besides these \DIFdelbegin \DIFdel{stylized }\DIFdelend \DIFaddbegin \DIFadd{stylised }\DIFaddend facts, these calibration results altogether demonstrate the feasibility of \DIFdelbegin \DIFdel{model application }\DIFdelend \DIFaddbegin \DIFadd{the application of the model }\DIFaddend to real data. \DIFaddbegin \DIFadd{As stated previously, the model is not predictive and the relatively high error values would not make it satisfactory in that manner, but are reasonable for its explanatory and application functions.
}\DIFaddend 


\section*{Application: impact of economic shock}

\DIFdelbegin \DIFdel{We finally }\DIFdelend \DIFaddbegin \DIFadd{Let us }\DIFaddend design scenarios to evaluate the impact of economic shocks. These can be the consequence of diverse factors, including socio-economic, geopolitical factors (\DIFaddbegin \DIFadd{the }\DIFaddend example of Brexit), or other unpredicted human disasters such as the COVID-19 pandemic. We \DIFdelbegin \DIFdel{simulate }\DIFdelend \DIFaddbegin \DIFadd{introduce the shock of the latter by simulating }\DIFaddend border closures by rescaling $c_0$ -- the range parameter for socio-economic interactions --, and intra-country lock-downs by rescaling $d_0$ -- the range parameter for direct interactions -- \DIFdelbegin \DIFdel{during the simulation, with other parameters being }\DIFdelend \DIFaddbegin \DIFadd{leaving other parameters }\DIFaddend fixed to their default values\DIFaddbegin \DIFadd{, }\DIFaddend and the model setup in the real configuration. More precisely, with $t_f = 5000$, the model is run for $t_f / 2$ steps. Then, \DIFdelbegin \DIFdel{following }\DIFdelend \DIFaddbegin \DIFadd{we introduce the effect of the shock through }\DIFaddend two new rate parameters $\kappa_C \in \left[0;1\right]$ and $\kappa_G \in \left[0;1\right]$\DIFdelbegin \DIFdel{defining the shock, }\DIFdelend \DIFaddbegin \DIFadd{, such that the }\DIFaddend model parameters are updated as $d_0 = \kappa_G \cdot d_0$ and $c_0 = \kappa_C \cdot c_0$. The model is then run for the remaining time steps until $t_f$. We study the temporal trajectory of indicators to see the impact of the shock in time. The experiment is run for $(\kappa_G,\kappa_C)$ ranging between 0.2 (strong restrictions) to 1 (reference trajectory), with 100 model repetitions.

Results are shown in Fig.~\ref{fig:fig9}. We find an important impact of the shock on internationalisation, but less on the average community size. The impact of changing $d_0$ is more important than $c_0$, but a combination of both \DIFdelbegin \DIFdel{yield }\DIFdelend \DIFaddbegin \DIFadd{yields }\DIFaddend the stronger effect. For minimal values of $\kappa_G$ and $\kappa_C$, internationalisation is more than doubled, confirming a reconfiguration of urban networks within countries. We validate the statistical significance of effects observed in Fig.~\ref{fig:fig9} by comparing distributions with Kolmogorov-Smirnov (KS) tests. More precisely, we proceed for each indicator and value of $(\kappa_G,\kappa_C)$ to a two-sided KS test between the statistical distribution of the indicator over repetitions at \DIFaddbegin \DIFadd{the }\DIFaddend final time with the distribution in the reference configuration. For internationalisation, p-values of the test are all smaller than 0.002 for $\kappa_D < 0.6$ but larger than $0.15$ for $\kappa_D \geq 0.6$. This means that the shock has a statistically significant impact only when \DIFaddbegin \DIFadd{the }\DIFaddend interaction range is more than halved. For community size, significance (p-value smaller than 0.01) is reached only for the smallest value $\kappa_D = 0.2$. Thus, the trajectory of the urban network is rather resilient to moderate shocks. This application shows how the model could be applied to practical policy issues.


%DIF <  computePvalMat(res$internationalizationTS.98)
%DIF <              [,1]         [,2]        [,3]         [,4]        [,5]
%DIF < [1,] 4.884981e-15 4.440892e-16 0.000000000 0.0000000000 0.000000000
%DIF < [2,] 1.364656e-03 9.570235e-06 0.001364656 0.0002468196 0.002318458
%DIF < [3,] 8.127483e-01 6.993742e-01 0.999633292 0.4675585921 0.154538055
%DIF < [4,] 5.806178e-01 8.127483e-01 0.366726444 0.6993741999 0.906206390
%DIF < [5,] 8.127483e-01 2.809600e-01 0.210551633 0.4675585921 1.000000000
%DIF <  computePvalMat(res$networkAvgCommunitySizeTS.98)
%DIF <              [,1]         [,2]         [,3]         [,4]         [,5]
%DIF < [1,] 4.365916e-08 4.705150e-06 3.728748e-05 2.267454e-06 1.071070e-06
%DIF < [2,] 5.410262e-02 6.993742e-01 6.302223e-03 1.545381e-01 4.675586e-01
%DIF < [3,] 9.670685e-01 1.545381e-01 9.996333e-01 9.996333e-01 4.675586e-01
%DIF < [4,] 4.675586e-01 5.806178e-01 4.675586e-01 9.670685e-01 6.993742e-01
%DIF < [5,] 9.670685e-01 5.806178e-01 4.675586e-01 6.993742e-01 1.000000e+00
\DIFdelbegin %DIFDELCMD < 

%DIFDELCMD < %%%
\DIFdelend %%%%%%%%%%%%%%
\begin{figure}
	%DIF < \begin{center}
    \DIFaddbeginFL \begin{center}
    \DIFaddendFL %\includegraphics[width=\linewidth]{figures/Fig9.png}
    %DIF < \end{center}
    \DIFdelbeginFL %DIFDELCMD < \vspace{2cm}
%DIFDELCMD < 	%%%
\DIFdelendFL \DIFaddbeginFL \end{center}
	\DIFaddendFL \caption{\textbf{Application of the calibrated model to an economic shock scenario.} All plots show the trajectory of indicators (internationalisation for the top row and average community size for the bottom row) in time, for different values of interaction decay rescaling $\kappa_G$ (\DIFdelbeginFL \DIFdelFL{color}\DIFdelendFL \DIFaddbeginFL \DIFaddFL{colour}\DIFaddendFL ) and socio-economic distance rescaling $\kappa_C$ (panels). The vertical dotted red line shows the moment the economic shock is introduced and $d_0$ (respectively $c_0$) is set to $\kappa_G \cdot d_0$ (resp. $\kappa_C \cdot c_0$).\label{fig:fig9}}
\end{figure}
%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%
\section*{Discussion}

This paper aimed at presenting a generative model for urban networks defined by interactions between firms based on synthetic data, simulated via the \DIFdelbegin \DIFdel{OpenMole }\DIFdelend \DIFaddbegin \DIFadd{OpenMOLE }\DIFaddend platform and calibrated on real data on ownership linkages of firms for Europe from the Amadeus dataset. The simulation on a synthetic system of cities provides a broad knowledge on model \DIFdelbegin \DIFdel{behavior }\DIFdelend \DIFaddbegin \DIFadd{behaviour }\DIFaddend in its parameter space. Even in such a simple model (close to directly tractable stationary state) the behaviour is highly non-linear in many dimensions. Our study shows how crucial model exploration is to overcome hidden parameters (deactivated mechanisms or default parameter values). This paper \DIFdelbegin \DIFdel{emphasis on }\DIFdelend \DIFaddbegin \DIFadd{highlights }\DIFaddend the fact that \DIFdelbegin \DIFdel{exploration of }\DIFdelend \DIFaddbegin \DIFadd{the exploration of the }\DIFaddend intrinsic dynamics on synthetic data is of great importance and should be driven before an application on real data\DIFdelbegin \DIFdel{so as to put }\DIFdelend \DIFaddbegin \DIFadd{, in order to set }\DIFaddend aside the geographical effects \DIFdelbegin \DIFdel{from }\DIFdelend \DIFaddbegin \DIFadd{in the }\DIFaddend model dynamics.

The \DIFdelbegin \DIFdel{calibration of model suggests }\DIFdelend \DIFaddbegin \DIFadd{model calibration results provide model parametrisations reasonably approaching the observed network. This validates }\DIFaddend its potential application to \DIFdelbegin \DIFdel{policy issues and can therefore have }\DIFdelend \DIFaddbegin \DIFadd{stylised policy issues with }\DIFaddend practical applications in the future. For example the effect of exogenous shocks in the socio-economic structure can be tested as we did in the \DIFdelbegin \DIFdel{stylized }\DIFdelend \DIFaddbegin \DIFadd{stylised }\DIFaddend application example above. Such shocks can for example be the upcoming impact of Brexit on the European market or the consequence of a long-term closure of the European Union members' borders due to further pandemic outbreaks on the single market. In this sense the UK economic sectors mostly dependent on foreign capital and generating the highest turnovers in 2018, that would be the most affected and worth examining in \DIFdelbegin \DIFdel{details are: }\DIFdelend \DIFaddbegin \DIFadd{detail are: the }\DIFaddend extraction of crude petroleum, \DIFaddbegin \DIFadd{the }\DIFaddend manufacture of tobacco products and of basic pharmaceutical goods (in terms of out-going links from the UK) ; \DIFaddbegin \DIFadd{the }\DIFaddend activities of head offices and holding companies, \DIFaddbegin \DIFadd{the }\DIFaddend sale of cars and manufacture of motor vehicles (in terms of in-going links to the UK). We showed in our experiment that although the system is resilient to moderate shocks, strong restrictions have an important impact on \DIFdelbegin \DIFdel{internationalization }\DIFdelend \DIFaddbegin \DIFadd{internationalisation }\DIFaddend and thus can be expected to have a detrimental effect on \DIFaddbegin \DIFadd{the }\DIFaddend UK economy due to these foreign ownership links (see also S1 Text). \DIFaddbegin \DIFadd{The impact of such unforeseen economic shocks could also be considered from a multi-level perspective, coupling our work with other approaches such as \mbox{%DIFAUXCMD
\cite{Dorretal2022} }\hspace{0pt}%DIFAUXCMD
studying the firm-level impact of the Covid crisis.
}\DIFaddend 

Several possible extensions of the current work can be undertaken in the future\DIFdelbegin \DIFdel{as a co-evolution model with an evolution of city sizes or a model with firm agents leading to a multi-scale agent-based model. A more }\DIFdelend \DIFaddbegin \DIFadd{. A simple extension with additional processes could include for example: (i) self-connections to account for links within FUAs; (ii) edge deletion which would capture the sell of subsidies to other companies; (iii) a }\DIFaddend precise study of the role of path dependency \DIFdelbegin \DIFdel{can }\DIFdelend \DIFaddbegin \DIFadd{should }\DIFaddend also be undertaken in order to \DIFdelbegin \DIFdel{understand }\DIFdelend \DIFaddbegin \DIFadd{anticipate }\DIFaddend the creation of \DIFdelbegin \DIFdel{the future links. Other }\DIFdelend \DIFaddbegin \DIFadd{future links; (iv) other }\DIFaddend formulations of the \DIFaddbegin \DIFadd{generative }\DIFaddend model might be taken into consideration as other \DIFdelbegin \DIFdel{formulation of the combination of factors or }\DIFdelend \DIFaddbegin \DIFadd{approaches to combine factors such as }\DIFaddend multi-objective optimisation depending on sectors using Pareto fronts\DIFaddbegin \DIFadd{; (v) allow for a dynamical calibration with a more detailed realistic representation of temporal dynamics, accounting for temporal non-stationarity for example}\DIFaddend .

\DIFaddbegin \DIFadd{We also suggest that our simple agent-based model can be a basis for or a component of more complicated economic agent-based models. A co-evolution model with an evolution of city sizes in parallel to the firm network would be more realistic for an application on longer time scales, but would also be more difficult to parametrise and calibrate \mbox{%DIFAUXCMD
\cite{raimbault2018characterising}}\hspace{0pt}%DIFAUXCMD
. A model with additional firm agents would lead to a multi-scale agent-based model, with also more flexibility for policy applications. The link with data could also be more elaborated: indeed the statistical analysis does not include spatial or neighbourhood effects, and spatial non-stationarity may be accounted for using Geographically Weighted Regression models for example \mbox{%DIFAUXCMD
\cite{comber2021route}}\hspace{0pt}%DIFAUXCMD
, to then be coupled with the ABM in an hybrid approach. Finally, an adaptation at the world scale using for example urban regions and data explored by \mbox{%DIFAUXCMD
\cite{rozenblat2021intra}}\hspace{0pt}%DIFAUXCMD
, would be an extension with important practical and theoretical potentialities. 
}


\DIFaddend \section*{Supporting information}

\DIFdelbegin \paragraph*{\DIFdel{S1 Text.}}
%DIFAUXCMD
%DIFDELCMD < \label{S1Text}
%DIFDELCMD < {\bf %%%
\DIFdel{UK's economic sectors dependent on international links. }%DIFDELCMD < }
%DIFDELCMD < %%%
\DIFdelend \DIFaddbegin \subsection*{\DIFadd{S1 Text: UK's economic sectors dependent on international links.}\label{S1Text}}
\DIFaddend 


Summary of links between UK and the rest of the EU, by economic sector.

\DIFdelbegin \paragraph*{\DIFdel{S2 Text.}}
%DIFAUXCMD
\DIFdelend \DIFaddbegin \subsection*{\DIFadd{S2 Text: Statistical models, generative model setup and sensitivity analysis.}}
\DIFaddend \label{S2Text}
\DIFdelbegin %DIFDELCMD < {\bf %%%
\DIFdel{Model setup and sensitivity analysis.}%DIFDELCMD < }
%DIFDELCMD < %%%
\DIFdelend 

Details on the \DIFaddbegin \DIFadd{empirical analysis and the }\DIFaddend simulation model:
\DIFaddbegin 

\begin{itemize}
    \item \DIFadd{additional zero-inflated and hurdle statistical models;
    }\item \DIFaddend summary statistics for the socio-economic distance matrix\DIFdelbegin \DIFdel{, }\DIFdelend \DIFaddbegin \DIFadd{;
    }\item \DIFaddend procedure for the synthetic model setup\DIFdelbegin \DIFdel{and detailed }\DIFdelend \DIFaddbegin \DIFadd{;
    }\item \DIFaddend Global Sensitivity Analysis\DIFdelbegin \DIFdel{.
}\DIFdelend \DIFaddbegin \DIFadd{;
    }\item \DIFadd{model calibration.
}\end{itemize}
\DIFaddend 



\section*{Acknowledgments}

Results obtained in this paper were computed on the vo.complex-system.eu virtual organization of the European Grid Infrastructure (http://www.egi.eu). We thank the European Grid Infrastructure and its supporting National Grid Initiatives (France-Grilles in particular) for providing the technical support and infrastructure. We also acknowledge the funding of the EPSRC grant EP/M023583/1.


\bibliographystyle{plos2015}
\bibliography{biblio}




\end{document}
